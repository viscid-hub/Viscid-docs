
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>viscid.npdatetime &#8212; Viscid 0.99.9.dev3 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="icon" href="../../_static/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="../../_static/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon-precomposed" href="../../_static/Vicon_128.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="stylesheet" href="../../_static/my-css.css" type="text/css" />

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          Viscid</a>
        <span class="navbar-text navbar-version pull-left"><b>0.99.9.dev3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
    <li class="dropdown">
      <a role="button"
         id="dLabelNavLinxToc"
         data-toggle="dropdown"
         data-target="#"
         href="#">Tutorial <b class="caret"></b></a>
      <ul class="dropdown-menu navlinktoc"
          role="menu">
          <li class="toctree-l1">
            <a class="reference internal", href="../../installation.html">Installation</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/creating_fields.html">Creating Fields</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/slicing.html">Slicing Fields</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/plotting_scalars.html">Plotting Scalars</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/plotting_vectors.html">Plotting Vectors</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/mayavi.html">3D Plots (Mayavi)</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/openggcm.html">OpenGGCM Specific</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/ionosphere.html">Ionosphere</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/stream_and_interp.html">Streamline and Interpolation</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/magnetic_topology.html">Magnetic Topology</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/magnetopause.html">Magnetopause</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../tutorial/quasi_potential.html">Quasi Potential</a>
          </li>
      </ul>
    </li>

            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">ChangeLog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indexing.html">Indexing Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tips_and_tricks.html">Tips &amp; Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html">Useful Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot_options.html">Plot Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mpl_style_gallery.html">Matplotlib Style Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../custom_behavior.html">Custom Behavior (rc file)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide.html">Developerâ€™s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending_readers.html">Extending Readers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/viscid.html">API</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for viscid.npdatetime</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;This is a shim to use numpy datetime64 and timedelta64 types</span>

<span class="sd">Times must be given in ISO 8601 format as per numpy &gt;= 1.7.</span>

<span class="sd">All arguments as strings are assumed to be ZULU (UTC) time. This</span>
<span class="sd">keeps the interface the same for numpy versions both before and</span>
<span class="sd">after 1.11 when datetime64 became timezone agnostic.</span>

<span class="sd">Note:</span>
<span class="sd">    There is some trickery here. For numpy versions prior to 1.11, this</span>
<span class="sd">    module will force ZULU (UTC) time. Note that when these datetimes</span>
<span class="sd">    are printed, numpy will display the local time. This will not be</span>
<span class="sd">    a problem for matplotlib plots if arr.astype(datetime.datetime) is</span>
<span class="sd">    used. This is because python&#39;s datetime objects are timezone</span>
<span class="sd">    agnostic, so matplotlib won&#39;t know a thing about your local TZ.</span>

<span class="sd">See Also:</span>
<span class="sd">    Information about the time span of each time unit is available at</span>
<span class="sd">    [1]_.</span>

<span class="sd">References:</span>
<span class="sd">    .. [1] http://docs.scipy.org/doc/numpy/reference/arrays.datetime.html#datetime-units</span>

<span class="sd">This module is completely orthogonal to Viscid, so that it can be</span>
<span class="sd">ripped out and used more generally. Please note that Viscid is MIT</span>
<span class="sd">licensed, which requires attribution.</span>

<span class="sd">The MIT License (MIT)</span>
<span class="sd">Copyright (c) 2017 Kristofor Maynard</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">distutils.version</span> <span class="k">import</span> <span class="n">LooseVersion</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">izip</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">izip</span> <span class="o">=</span> <span class="nb">zip</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">string_types</span> <span class="o">=</span> <span class="nb">str</span><span class="p">,</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">string_types</span> <span class="o">=</span> <span class="n">basestring</span><span class="p">,</span>  <span class="c1"># pylint: disable=undefined-variable</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PrecisionError&#39;</span><span class="p">,</span>
           <span class="s1">&#39;as_datetime64&#39;</span><span class="p">,</span> <span class="s1">&#39;as_timedelta64&#39;</span><span class="p">,</span> <span class="s1">&#39;as_datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;as_timedelta&#39;</span><span class="p">,</span>
           <span class="s1">&#39;to_datetime64&#39;</span><span class="p">,</span> <span class="s1">&#39;to_timedelta64&#39;</span><span class="p">,</span> <span class="s1">&#39;to_datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;to_timedelta&#39;</span><span class="p">,</span>
           <span class="s1">&#39;as_isotime&#39;</span><span class="p">,</span> <span class="s1">&#39;to_isotime&#39;</span><span class="p">,</span> <span class="s1">&#39;format_time&#39;</span><span class="p">,</span> <span class="s1">&#39;format_datetime&#39;</span><span class="p">,</span>
           <span class="s1">&#39;is_valid_datetime64&#39;</span><span class="p">,</span> <span class="s1">&#39;is_valid_timedelta64&#39;</span><span class="p">,</span>
           <span class="s1">&#39;datetime_as_seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;timedelta_as_seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;time_as_seconds&#39;</span><span class="p">,</span>
           <span class="s1">&#39;datetime64_as_years&#39;</span><span class="p">,</span>
           <span class="s1">&#39;asarray_datetime64&#39;</span><span class="p">,</span> <span class="s1">&#39;linspace_datetime64&#39;</span><span class="p">,</span>
           <span class="s1">&#39;round_time&#39;</span><span class="p">,</span> <span class="s1">&#39;regularize_time&#39;</span><span class="p">,</span>
           <span class="s1">&#39;time_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;time_diff&#39;</span><span class="p">,</span>
           <span class="s1">&#39;is_datetime_like&#39;</span><span class="p">,</span> <span class="s1">&#39;is_timedelta_like&#39;</span><span class="p">,</span> <span class="s1">&#39;is_time_like&#39;</span><span class="p">]</span>


<span class="n">_NP_TZ</span> <span class="o">=</span> <span class="n">LooseVersion</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">LooseVersion</span><span class="p">(</span><span class="s1">&#39;1.11&#39;</span><span class="p">)</span>
<span class="n">TIME_UNITS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;as&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="s1">&#39;ns&#39;</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">TIME_SCALE</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">DATE_UNITS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">ORDERED_UNITS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">TIME_UNITS</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">DATE_UNITS</span><span class="p">)</span>

<span class="n">DATETIME_BASE</span> <span class="o">=</span> <span class="s2">&quot;datetime64&quot;</span>
<span class="n">DELTA_BASE</span> <span class="o">=</span> <span class="s2">&quot;timedelta64&quot;</span>


<div class="viewcode-block" id="PrecisionError"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.PrecisionError">[docs]</a><span class="k">class</span> <span class="nc">PrecisionError</span><span class="p">(</span><span class="ne">ArithmeticError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used if conversion to a time unit truncates value to 0&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="c1"># This class is for Python2.6 compatability since in 2.6, timedelta has</span>
<span class="c1"># no total_seconds method</span>
<span class="k">class</span> <span class="nc">TimeDeltaCompat</span><span class="p">(</span><span class="n">timedelta</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-method-argument</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">timedelta</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span>
                                     <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">microseconds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">timedelta</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">total_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TimeDeltaCompat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span>
                    <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>


<span class="k">def</span> <span class="nf">_format_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">DATETIME_BASE</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">base</span>

<span class="k">def</span> <span class="nf">_as_dtype</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">t</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">dtype</span>

<span class="k">def</span> <span class="nf">_get_base_unit</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_as_dtype</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)]</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">base</span><span class="p">,</span> <span class="n">unit</span>

<span class="k">def</span> <span class="nf">_get_unit</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_get_base_unit</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_is_datetime64</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_as_dtype</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span>

<span class="k">def</span> <span class="nf">_is_dateunit</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_is_datetime64</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_get_unit</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DATE_UNITS</span>

<span class="k">def</span> <span class="nf">_is_timeunit</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_is_datetime64</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_get_unit</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TIME_UNITS</span>

<span class="k">def</span> <span class="nf">_as_datetime64_scalar</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">unit_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">unit</span><span class="p">]</span> <span class="k">if</span> <span class="n">unit</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">is_timedelta_like</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_format_unit</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">as_isotime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">pass</span>  <span class="c1"># Let ValueErrors happen in numpy constructors below</span>

        <span class="k">if</span> <span class="n">_is_timeunit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_NP_TZ</span><span class="p">:</span>
            <span class="n">has_tz</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;.*([+-][0-9]{2,4}|Z)$&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_tz</span><span class="p">:</span>
                <span class="n">time</span> <span class="o">+=</span> <span class="s1">&#39;Z&#39;</span>

        <span class="n">scalar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="o">*</span><span class="n">unit_args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">unit_args</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;astype&#39;</span><span class="p">):</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_format_unit</span><span class="p">(</span><span class="n">unit_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="o">*</span><span class="n">unit_args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scalar</span>

<span class="k">def</span> <span class="nf">_as_timedelta64_scalar</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">unit_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">unit</span><span class="p">]</span> <span class="k">if</span> <span class="n">unit</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">flt_unit</span> <span class="o">=</span> <span class="n">unit</span> <span class="k">if</span> <span class="n">unit</span> <span class="k">else</span> <span class="s1">&#39;s&#39;</span>
    <span class="c1"># turn &#39;H:M:S.ms&#39;, &#39;M:S.ms&#39;, &#39;S.ms&#39; into floating point seconds</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span><span class="c1"># and &#39;:&#39; in time:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When giving time as a string, units are automatic&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Timedelta as string only goes up to hours&quot;</span><span class="p">)</span>
        <span class="n">t_flt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">factor</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">],</span> <span class="n">time</span><span class="p">):</span>
            <span class="n">t_flt</span> <span class="o">+=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">t</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">t_flt</span>
        <span class="n">flt_unit</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
    <span class="c1"># turn floating point time into integer with the correct unit</span>
    <span class="k">if</span> <span class="n">is_datetime_like</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">-</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">)):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_format_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">DELTA_BASE</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
        <span class="n">orig_time</span><span class="p">,</span> <span class="n">orig_flt_unit</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">flt_unit</span>
        <span class="n">unit_idx</span> <span class="o">=</span> <span class="n">TIME_UNITS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">flt_unit</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-18</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">unit_idx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floating point time </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] is too precise &quot;</span>
                                 <span class="s2">&quot;for any time unit?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orig_time</span><span class="p">,</span> <span class="n">orig_flt_unit</span><span class="p">))</span>
            <span class="n">unit_idx</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">time</span> <span class="o">*=</span> <span class="n">TIME_SCALE</span><span class="p">[</span><span class="n">unit_idx</span><span class="p">]</span>
            <span class="n">flt_unit</span> <span class="o">=</span> <span class="n">TIME_UNITS</span><span class="p">[</span><span class="n">unit_idx</span><span class="p">]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span> <span class="n">flt_unit</span><span class="p">)</span>
        <span class="n">unit</span><span class="p">,</span> <span class="n">unit_args</span> <span class="o">=</span> <span class="n">flt_unit</span><span class="p">,</span> <span class="p">[</span><span class="n">flt_unit</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="o">*</span><span class="n">unit_args</span><span class="p">)</span>

<div class="viewcode-block" id="as_isotime"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.as_isotime">[docs]</a><span class="k">def</span> <span class="nf">as_isotime</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Try to convert times in string format to ISO 8601</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Elements are not strings</span>
<span class="sd">        ValueError: numpy.datetime64(time) fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span><span class="p">]</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;UT&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[0-9]</span><span class="si">{2}</span><span class="s2">([0-9]</span><span class="si">{2}</span><span class="s2">:){3,5}[0-9]{1,2}(\.[0-9]*)?$&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
                <span class="c1"># Handle YYYY:MM:DD:hh:mm:ss.ms -&gt; YYYY-MM-DDThh:mm:ss.ms</span>
                <span class="c1">#        YYYY:MM:DD:hh:mm:s.ms  -&gt; YYYY-MM-DDThh:mm:s.ms</span>
                <span class="c1">#        YYYY:MM:DD:hh:mm:ss    -&gt; YYYY-MM-DDThh:mm:ss</span>
                <span class="c1">#        YYYY:MM:DD:hh:mm       -&gt; YYYY-MM-DDThh:mm</span>
                <span class="c1">#        YYYY:MM:DD:hh          -&gt; YYYY-MM-DDThh</span>
                <span class="c1"># -- all this _tsp nonsense is to take care of s.ms; annoying</span>
                <span class="n">_tsp</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">_tsp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tsp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">_tsp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_s</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_tsp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">]]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_tsp</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_tsp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">+=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">_tsp</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="c1"># --</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;T&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span>

            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[0-9]</span><span class="si">{2}</span><span class="s2">([0-9]</span><span class="si">{2}</span><span class="s2">:)</span><span class="si">{2}</span><span class="s2">[0-9]</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
                <span class="c1"># Handle YYYY:MM:DD -&gt; YYYY-MM-DD</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can only turn strings to ISO 8601 time format &quot;</span>
                            <span class="s2">&quot;(</span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">scalar</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="as_datetime64"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.as_datetime64">[docs]</a><span class="k">def</span> <span class="nf">as_datetime64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert to a Numpy datetime64 scalar or array</span>

<span class="sd">    Args:</span>
<span class="sd">        time: some python datetime or string in ISO 8601 format, could</span>
<span class="sd">            also be a sequence of these to return a Numpy ndarray</span>
<span class="sd">        unit (str): one of {Y,M,W,D,h,m,s,m,s,us,ns,ps,fs,as}</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.datetime64[unit] or array with dtype np.datetime64[unit]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_format_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_as_datetime64_scalar</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">time</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">_format_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;ns&#39;</span> <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">unit</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_format_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">DATETIME_BASE</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">_as_datetime64_scalar</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span></div>

<div class="viewcode-block" id="as_timedelta64"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.as_timedelta64">[docs]</a><span class="k">def</span> <span class="nf">as_timedelta64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert to a timedelta64 type</span>


<span class="sd">    Args:</span>
<span class="sd">        time (timedelta-like): an int/float/string/... to convert</span>
<span class="sd">        unit (None): This is the unit of the input, the result</span>
<span class="sd">            will be the most coarse unit that can store the time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_as_timedelta64_scalar</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">time</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;ns&#39;</span> <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">unit</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_format_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">DELTA_BASE</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">_as_timedelta64_scalar</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span></div>

<div class="viewcode-block" id="as_datetime"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.as_datetime">[docs]</a><span class="k">def</span> <span class="nf">as_datetime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert time to a Numpy ndarray of datetime.datetime objects</span>

<span class="sd">    Args:</span>
<span class="sd">        time: some python datetime or string in ISO 8601 format, could</span>
<span class="sd">            also be a sequence of these to return a Numpy ndarray</span>
<span class="sd">        unit (str): one of {Y,M,W,D,h,m,s,m,s,us,ns,ps,fs,as}</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray of native datetime.datetime objects (dtype = object)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dt64</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">dt64</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">as_timedelta64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">round_time</span><span class="p">(</span><span class="n">dt64</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">datetime</span><span class="p">)</span></div>

<div class="viewcode-block" id="as_timedelta"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.as_timedelta">[docs]</a><span class="k">def</span> <span class="nf">as_timedelta</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert time to a Numpy ndarray of datetime.datetime objects</span>

<span class="sd">    Note:</span>
<span class="sd">        Python timedelta objects are accurate up to microseconds</span>

<span class="sd">    Args:</span>
<span class="sd">        time: some python datetime or string in ISO 8601 format, could</span>
<span class="sd">            also be a sequence of these to return a Numpy ndarray</span>
<span class="sd">        unit (str): one of {Y,M,W,D,h,m,s,m,s,us,ns,ps,fs,as}</span>
<span class="sd">        allow0 (bool): If False, then raise PrecisionError if a value</span>
<span class="sd">            has been rounded to 0</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray of native datetime.datetime objects (dtype = object)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="n">allow0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="s2">&quot;total_seconds&quot;</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">TimeDeltaCompat</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;total_seconds&quot;</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">TimeDeltaCompat</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="asarray_datetime64"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.asarray_datetime64">[docs]</a><span class="k">def</span> <span class="nf">asarray_datetime64</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conservative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If is_valid_datetime64, then return a datetime64 array</span>

<span class="sd">    Args:</span>
<span class="sd">        arr (sequence): something that can become an arary</span>
<span class="sd">        unit (str): one of {Y,M,W,D,h,m,s,m,s,us,ns,ps,fs,as}</span>
<span class="sd">        conservative (bool): If True, then only turn arr into a</span>
<span class="sd">            date-time array if it really looks like it</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">conservative</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_datetime_like</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></div>

<div class="viewcode-block" id="linspace_datetime64"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.linspace_datetime64">[docs]</a><span class="k">def</span> <span class="nf">linspace_datetime64</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make an evenly space ndarray from start to stop with n values&quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">regularize_time</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">],</span> <span class="n">most_precise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">fltarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">),</span> <span class="n">stop</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span>
                         <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f8&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">fltarr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_most_precise_t_unit</span><span class="p">(</span><span class="n">tlst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find the most precise time unit from the bunch</span>

<span class="sd">    Args:</span>
<span class="sd">        tlst: datetime64 or timedelta64 instances</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: unit of the most precise time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_base_unit</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlst</span><span class="p">]</span>
    <span class="n">unit_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">ORDERED_UNITS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">units</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">units</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">unit_idx</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">_adjust_t_unit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">cfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;adjust the unit of t using cfunc</span>

<span class="sd">    Args:</span>
<span class="sd">        t (datetime64, timedelta64): time to convert</span>
<span class="sd">        unit: target unit</span>
<span class="sd">        cfunc (callable): one of `as_datetime64` or `as_timedelta64`</span>
<span class="sd">        allow0 (bool): If False, then raise PrecisionError if a value</span>
<span class="sd">            has been truncated to 0</span>

<span class="sd">    Raises:</span>
<span class="sd">        OverflowError: if all elements of tlst can&#39;t fit in the same</span>
<span class="sd">            unit</span>
<span class="sd">        PrecisionError: if rounding a time truncated it to 0 and not</span>
<span class="sd">            `allow0`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">orig_base</span><span class="p">,</span> <span class="n">orig_unit</span> <span class="o">=</span> <span class="n">_get_base_unit</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cfunc_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;datetime64&#39;</span><span class="p">:</span> <span class="n">as_datetime64</span><span class="p">,</span>
                        <span class="s1">&#39;timedelta64&#39;</span><span class="p">:</span> <span class="n">as_timedelta64</span><span class="p">}</span>
        <span class="n">cfunc</span> <span class="o">=</span> <span class="n">cfunc_lookup</span><span class="p">[</span><span class="n">orig_base</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">orig_unit</span> <span class="o">==</span> <span class="n">unit</span><span class="p">:</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">t</span>
    <span class="k">elif</span> <span class="n">ORDERED_UNITS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ORDERED_UNITS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">orig_unit</span><span class="p">):</span>
        <span class="c1"># we want a more precise unit... raise an OverflowError if the</span>
        <span class="c1"># new unit can not store the most coarse part of t</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">cfunc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="c1"># converting back to orig_unit and checking t == t2 effectively</span>
        <span class="c1"># checks to make sure we haven&#39;t overflowed into the sign bit</span>
        <span class="c1"># since this isn&#39;t checked by Numpy internally. if the conversion</span>
        <span class="c1"># overflowed a 64-bit int completely, an OverflowError has already</span>
        <span class="c1"># been raised</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">cfunc</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">orig_unit</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="n">t2</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s2">&quot;Time </span><span class="si">{0}</span><span class="s2"> could not be refined to unit &#39;</span><span class="si">{1}</span><span class="s2">&#39; &quot;</span>
                                    <span class="s2">&quot;because it overflowed into the sign bit (</span><span class="si">{2}</span><span class="s2">).&quot;</span>
                                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">viscid</span><span class="p">;</span> <span class="n">viscid</span><span class="o">.</span><span class="n">interact</span><span class="p">()</span>
            <span class="k">raise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># we want a less precise unit, i.e., round t to the new unit... raise</span>
        <span class="c1"># a PrecisionError if t was rounded to 0</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">cfunc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow0</span> <span class="ow">and</span> <span class="n">t1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PrecisionError</span><span class="p">(</span><span class="s2">&quot;The time </span><span class="si">{0}</span><span class="s2"> was truncated to 0 when &quot;</span>
                                 <span class="s2">&quot;rounded to the nearest &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span>
                                 <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">unit</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">t1</span>

<div class="viewcode-block" id="round_time"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.round_time">[docs]</a><span class="k">def</span> <span class="nf">round_time</span><span class="p">(</span><span class="n">tlst</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Round a time or list of times to minimum level of coarseness</span>

<span class="sd">    Note:</span>
<span class="sd">        * When rounding, some values might be rounded to 0. If you</span>
<span class="sd">          rather raise a PrecisionError, then give `allow0=False`.</span>

<span class="sd">    Args:</span>
<span class="sd">        tlst (timelike, list): single or list of datetime64 or</span>
<span class="sd">            timedelta64</span>
<span class="sd">        unit (str): units of result will be at least as coarse as</span>
<span class="sd">            this unit</span>
<span class="sd">        allow0 (bool): If False, then raise PrecisionError if a value</span>
<span class="sd">            has been truncated to 0</span>

<span class="sd">    Returns:</span>
<span class="sd">        timelike or list: `tlst` rounded to a unit at least as coarse</span>
<span class="sd">            as `unit`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cfunc_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;datetime64&#39;</span><span class="p">:</span> <span class="n">as_datetime64</span><span class="p">,</span>
                    <span class="s1">&#39;timedelta64&#39;</span><span class="p">:</span> <span class="n">as_timedelta64</span><span class="p">}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tlst</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="n">tlst</span> <span class="o">=</span> <span class="p">[</span><span class="n">tlst</span><span class="p">]</span>
        <span class="n">single_val</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">single_val</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bases_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_base_unit</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlst</span><span class="p">]</span>
    <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="n">bu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">bu</span> <span class="ow">in</span> <span class="n">bases_units</span><span class="p">]</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">bu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">bu</span> <span class="ow">in</span> <span class="n">bases_units</span><span class="p">]</span>
    <span class="n">unit_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ORDERED_UNITS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">units</span><span class="p">]</span>
    <span class="n">unit0_idx</span> <span class="o">=</span> <span class="n">ORDERED_UNITS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">unit_idx</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">tlst</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">unit_idxs</span><span class="p">):</span>
        <span class="n">cfunc</span> <span class="o">=</span> <span class="n">cfunc_lookup</span><span class="p">[</span><span class="n">base</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unit_idx</span> <span class="o">&gt;=</span> <span class="n">unit0_idx</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_adjust_t_unit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">cfunc</span><span class="o">=</span><span class="n">cfunc</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="n">allow0</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">single_val</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tlst</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="regularize_time"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.regularize_time">[docs]</a><span class="k">def</span> <span class="nf">regularize_time</span><span class="p">(</span><span class="n">tlst</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">most_precise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_rounding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">allow0</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a list of times to a common unit</span>

<span class="sd">    Notes:</span>
<span class="sd">        * If some times are too fine to fit in the same unit as the</span>
<span class="sd">          rest of the times, then they will be rounded to a more</span>
<span class="sd">          coarse unit. If you rather raise an OverflowError, then give</span>
<span class="sd">          `allow_rounding=False`.</span>
<span class="sd">        * When rounding, some values might be rounded to 0. If you</span>
<span class="sd">          rather raise a PrecisionError, then give `allow0=False`.</span>

<span class="sd">    Args:</span>
<span class="sd">        tlst (timelike, list): single or list of datetime64 or</span>
<span class="sd">            timedelta64</span>
<span class="sd">        unit (str): If given, regularize all times to this unit,</span>
<span class="sd">            otherwise, regularize them to the most precise of the</span>
<span class="sd">            bunch</span>
<span class="sd">        most_precise (bool): If True, then convert all times to the</span>
<span class="sd">            most precise unit that fits all the times</span>
<span class="sd">        allow_rounding (bool): if any time is too small to be</span>
<span class="sd">            represented in the desired unit, then use a more coarse</span>
<span class="sd">            unit and round values so that everything fits</span>
<span class="sd">        allow0 (bool): If False, then raise PrecisionError if a value</span>
<span class="sd">            has been rounded to 0</span>

<span class="sd">    Returns:</span>
<span class="sd">        timelike or list: single or list of times all in the same unit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cfunc_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;datetime64&#39;</span><span class="p">:</span> <span class="n">as_datetime64</span><span class="p">,</span>
                    <span class="s1">&#39;timedelta64&#39;</span><span class="p">:</span> <span class="n">as_timedelta64</span><span class="p">}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tlst</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="n">tlst</span> <span class="o">=</span> <span class="p">[</span><span class="n">tlst</span><span class="p">]</span>
        <span class="n">single_val</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">single_val</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">_most_precise_t_unit</span><span class="p">(</span><span class="n">tlst</span><span class="p">)</span>

    <span class="n">bases_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_base_unit</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlst</span><span class="p">]</span>
    <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="n">bu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">bu</span> <span class="ow">in</span> <span class="n">bases_units</span><span class="p">]</span>
    <span class="n">cfuncs</span> <span class="o">=</span> <span class="p">[</span><span class="n">cfunc_lookup</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">]</span>

    <span class="c1"># round values to successively more coarse units until we get to</span>
    <span class="c1"># a unit that can contain all the times in our list</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ORDERED_UNITS</span><span class="p">[</span><span class="n">ORDERED_UNITS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">unit</span><span class="p">):]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">cfunc</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">tlst</span><span class="p">,</span> <span class="n">cfuncs</span><span class="p">):</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_adjust_t_unit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">cfunc</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="n">allow0</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_rounding</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span>
            <span class="k">break</span>

    <span class="c1"># if we want the most precise unit that fits everything, then keep</span>
    <span class="c1"># refining the unit until we get an OverflowError</span>
    <span class="k">if</span> <span class="n">most_precise</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ORDERED_UNITS</span><span class="p">[:</span><span class="n">ORDERED_UNITS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">unit</span><span class="p">)]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nxt</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">cfunc</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">cfuncs</span><span class="p">):</span>
                    <span class="n">nxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_adjust_t_unit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">cfunc</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="n">allow0</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">nxt</span>

    <span class="k">if</span> <span class="n">single_val</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tlst</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="time_sum"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.time_sum">[docs]</a><span class="k">def</span> <span class="nf">time_sum</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">tdelta</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">most_precise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_rounding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">allow0</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add timedelta64 to datetime64 at highest precision w/o overflow</span>

<span class="sd">    Notes:</span>
<span class="sd">        * If `allow_rounding`, then the result may not be in `unit`. If</span>
<span class="sd">          you rather raise an OverflowError, give `allow_rounding=False`</span>
<span class="sd">        * If t0 can not be represented using the same units as tdelta,</span>
<span class="sd">          then tdelta could be rounded to 0. If you rather raise a</span>
<span class="sd">          PrecisionError, then give `allow0=False`</span>

<span class="sd">    Args:</span>
<span class="sd">        t0 (datetime64): starting date</span>
<span class="sd">        tdelta (timedelta64): timedelta to add</span>
<span class="sd">        unit (str): If given, regularize all times to this unit,</span>
<span class="sd">            otherwise, regularize them to the most precise of the</span>
<span class="sd">            bunch</span>
<span class="sd">        most_precise (bool): If True, then convert all times to the</span>
<span class="sd">            most precise unit that fits all the times</span>
<span class="sd">        allow_rounding (bool): if tdelta is too small to be represented</span>
<span class="sd">            in the same unit as t0, then round it to the finest unit</span>
<span class="sd">            that fits both t0 and tdelta</span>
<span class="sd">        allow0 (bool): If False, and a value is rounded to 0 in a given</span>
<span class="sd">            unit, then raise a PrecisionError</span>

<span class="sd">    Returns:</span>
<span class="sd">        datetime64: t0 + tdelta</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
    <span class="n">tdelta</span> <span class="o">=</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="n">tdelta</span><span class="p">)</span>
    <span class="n">t0</span><span class="p">,</span> <span class="n">tdelta</span> <span class="o">=</span> <span class="n">regularize_time</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">tdelta</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span>
                                 <span class="n">most_precise</span><span class="o">=</span><span class="n">most_precise</span><span class="p">,</span>
                                 <span class="n">allow_rounding</span><span class="o">=</span><span class="n">allow_rounding</span><span class="p">,</span>
                                 <span class="n">allow0</span><span class="o">=</span><span class="n">allow0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">tdelta</span></div>

<div class="viewcode-block" id="time_diff"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.time_diff">[docs]</a><span class="k">def</span> <span class="nf">time_diff</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">most_precise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Diff two datetime64s at highest precision w/o overflow</span>

<span class="sd">    Note:</span>
<span class="sd">        If `allow_rounding`, then the result may not be in `unit`. If</span>
<span class="sd">        you rather raise an OverflowError, give `allow_rounding=False`</span>

<span class="sd">    Args:</span>
<span class="sd">        t1 (datetime64): `t1` for `t1 - t2`</span>
<span class="sd">        t2 (datetime64): `t2` for `t1 - t2`</span>
<span class="sd">        unit (str): If given, regularize all times to this unit,</span>
<span class="sd">            otherwise, regularize them to the most precise of the</span>
<span class="sd">            bunch</span>
<span class="sd">        most_precise (bool): If True, then convert all times to the</span>
<span class="sd">            most precise unit that fits all the times</span>

<span class="sd">    Returns:</span>
<span class="sd">        timedelta64: t1 - t2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
    <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">regularize_time</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">most_precise</span><span class="o">=</span><span class="n">most_precise</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t2</span></div>

<div class="viewcode-block" id="is_valid_datetime64"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.is_valid_datetime64">[docs]</a><span class="k">def</span> <span class="nf">is_valid_datetime64</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True iff arr can be made into a datetime64 array&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">as_datetime64</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="is_valid_timedelta64"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.is_valid_timedelta64">[docs]</a><span class="k">def</span> <span class="nf">is_valid_timedelta64</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True iff arr can be made into a timedelta64 array&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">as_timedelta64</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="datetime_as_seconds"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.datetime_as_seconds">[docs]</a><span class="k">def</span> <span class="nf">datetime_as_seconds</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;round datetime a to the nearest decimals seconds&quot;&quot;&quot;</span>
    <span class="n">a_as_dt64</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="n">_epoch</span> <span class="o">=</span> <span class="n">regularize_time</span><span class="p">(</span><span class="n">a_as_dt64</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">frac</span> <span class="o">=</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">a_as_dt64</span><span class="p">,</span> <span class="n">_epoch</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">rounded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span> <span class="n">decimals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">_epoch</span> <span class="o">+</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="n">rounded</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="timedelta_as_seconds"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.timedelta_as_seconds">[docs]</a><span class="k">def</span> <span class="nf">timedelta_as_seconds</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;round timedelta a to the nearest decimals seconds</span>

<span class="sd">    Note:</span>
<span class="sd">        works for &#39;fs&#39;, but not &#39;as&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_td64</span> <span class="o">=</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="n">rounded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a_td64</span> <span class="o">/</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span> <span class="n">decimals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="n">rounded</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="time_as_seconds"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.time_as_seconds">[docs]</a><span class="k">def</span> <span class="nf">time_as_seconds</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;round a to the nearest decimal seconds&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_datetime_like</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datetime_as_seconds</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">is_timedelta_like</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">conservative</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">timedelta_as_seconds</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">)</span></div>

<div class="viewcode-block" id="format_datetime"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.format_datetime">[docs]</a><span class="k">def</span> <span class="nf">format_datetime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%.02f</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shortcut to :py:func:`format_time` for a datetime format&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">format_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span></div>

<div class="viewcode-block" id="format_time"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.format_time">[docs]</a><span class="k">def</span> <span class="nf">format_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.02f&#39;</span><span class="p">,</span> <span class="n">basetime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format time as a string</span>

<span class="sd">    Args:</span>
<span class="sd">        t (float): time</span>
<span class="sd">        style (str): for this method, can be::</span>

<span class="sd">              -----------------------   -------   ----------------------------</span>
<span class="sd">              style                     time      string</span>
<span class="sd">              -----------------------   -------   ----------------------------</span>
<span class="sd">              &#39;hms&#39;                     90015.0   &quot;25:00:15&quot;</span>
<span class="sd">              &#39;hmss&#39;                    90015.0   &quot;25:00:15 (090015)&quot;</span>
<span class="sd">              &#39;dhms&#39;                      900.0   &quot;0 days 00:15:00&quot;</span>
<span class="sd">              &#39;dhmss&#39;                     900.0   &quot;0 days 00:15:00 (000900)&quot;</span>
<span class="sd">              &#39;.02f&#39;                      900.0   &#39;900.00&#39;</span>
<span class="sd">              &#39;%Y-%m-%d %H:%M:%S&#39;         900.0   &#39;1970-01-01 00:15:00&#39;</span>
<span class="sd">              &#39;%Y-%m-%d %H:%M:%S.%1f&#39;     900.0   &#39;1970-01-01 00:15:00.0&#39;</span>
<span class="sd">              -----------------------   -------   ----------------------------</span>

<span class="sd">            Note that the last one can involve any formatting strings</span>
<span class="sd">            understood by datetime.strftime</span>
<span class="sd">        basetime (np.datetime64): if formatting just number of seconds</span>
<span class="sd">            from something like &quot;.02f&quot;, then use this time as 0 seconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dttime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">basetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">basetime</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ut&#39;</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>

    <span class="k">if</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dhms&#39;</span><span class="p">,</span> <span class="s1">&#39;dhmss&#39;</span><span class="p">,</span> <span class="s1">&#39;hms&#39;</span><span class="p">,</span> <span class="s1">&#39;hmss&#39;</span><span class="p">):</span>
        <span class="c1"># These are special time-style formatters</span>
        <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">):</span>
            <span class="n">days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">as_timedelta64</span><span class="p">(</span><span class="n">dttime</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">days</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">days_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> day&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">days_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> days &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">days_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">dttime</span><span class="p">,</span> <span class="n">days_str</span> <span class="o">+</span> <span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;ss&#39;</span><span class="p">):</span>
            <span class="n">_tt</span> <span class="o">=</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">dttime</span><span class="p">,</span> <span class="n">basetime</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot; (</span><span class="si">{0:06d}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">_tt</span><span class="p">))</span>
    <span class="k">elif</span> <span class="s1">&#39;%&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="c1"># if there&#39;s no % symbol, then it&#39;s probably not a strftime format,</span>
        <span class="c1"># so use fmt as normal string formatting of total_seconds</span>
        <span class="n">_tt</span> <span class="o">=</span> <span class="p">(</span><span class="n">as_datetime64</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">-</span> <span class="n">basetime</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;{0:</span><span class="si">{1}</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_tt</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fmt</span><span class="p">:</span>
            <span class="n">msec_fmt</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msec_fmt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%\.?([0-9]*)f&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%\.?([0-9]*)f&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>

        <span class="n">tstr</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">dttime</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>

        <span class="c1"># now go back and for any %f -&gt; [0-9]{6}, reformat the precision</span>
        <span class="n">it</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">izip</span><span class="p">(</span><span class="n">msec_fmt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s2">&quot;[0-9]</span><span class="si">{6}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tstr</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">ffmt</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">it</span><span class="p">):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;0.&quot;</span> <span class="o">+</span> <span class="n">tstr</span><span class="p">[</span><span class="n">a</span><span class="p">:</span><span class="n">b</span><span class="p">])</span>
            <span class="n">ifmt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ffmt</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ffmt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">6</span>
            <span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;{0:0.</span><span class="si">{1}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ifmt</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">[:</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span> <span class="o">+</span> <span class="n">tstr</span><span class="p">[</span><span class="n">b</span><span class="p">:]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">tstr</span>
    <span class="k">return</span> <span class="n">ret</span></div>

<span class="k">def</span> <span class="nf">_check_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">_np_types</span><span class="p">,</span> <span class="n">_native_types</span><span class="p">,</span> <span class="n">check_str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># pylint: disable=too-many-return-statements</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks the follwing:</span>
<span class="sd">      - if val is instance of _np_types or _native_types</span>
<span class="sd">      - if val is a list or ndarray of _np_types or _native_types</span>
<span class="sd">      - if val is a string or list of strings that can be parsed by check_str</span>
<span class="sd">    Does not check:</span>
<span class="sd">      - if val is an ndarray of strings that can be parsed by check_str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_all_types</span> <span class="o">=</span> <span class="n">_np_types</span> <span class="o">+</span> <span class="n">_native_types</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">_all_types</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">check_str</span> <span class="ow">and</span> <span class="n">check_str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">check_str</span> <span class="ow">and</span> <span class="n">check_str</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">_all_types</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">_native_types</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">_np_types</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="datetime64_as_years"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.datetime64_as_years">[docs]</a><span class="k">def</span> <span class="nf">datetime64_as_years</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get time as floating point years since the year 0&quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="n">epoch_year</span> <span class="o">=</span> <span class="mi">1970</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-01-01T00:00:00.0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch_year</span><span class="p">))</span>
    <span class="n">tdelta</span> <span class="o">=</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">most_precise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">tdelta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">365.242</span> <span class="o">+</span> <span class="n">epoch_year</span>
    <span class="k">return</span> <span class="n">years</span></div>

<div class="viewcode-block" id="is_datetime_like"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.is_datetime_like">[docs]</a><span class="k">def</span> <span class="nf">is_datetime_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">conservative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="sd">&quot;&quot;&quot;Returns True iff val is datetime-like&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">conservative</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">conservative</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">_check_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="p">),</span>
                       <span class="n">is_valid_datetime64</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_timedelta_like"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.is_timedelta_like">[docs]</a><span class="k">def</span> <span class="nf">is_timedelta_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">conservative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True iff val is timedelta-like&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">conservative</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">_check_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="p">),</span>
                           <span class="n">is_valid_timedelta64</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_check_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">),</span>
                           <span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="n">is_valid_timedelta64</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_time_like"><a class="viewcode-back" href="../../api/viscid.npdatetime.html#viscid.is_time_like">[docs]</a><span class="k">def</span> <span class="nf">is_time_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">conservative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True iff val is datetime-like or timedelta-like&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">is_datetime_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">conservative</span><span class="o">=</span><span class="n">conservative</span><span class="p">)</span> <span class="ow">or</span>
            <span class="n">is_timedelta_like</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">conservative</span><span class="o">=</span><span class="n">conservative</span><span class="p">))</span></div>

<span class="n">to_datetime64</span> <span class="o">=</span> <span class="n">as_datetime64</span>
<span class="n">to_timedelta64</span> <span class="o">=</span> <span class="n">as_timedelta64</span>
<span class="n">to_datetime</span> <span class="o">=</span> <span class="n">as_datetime</span>
<span class="n">to_timedelta</span> <span class="o">=</span> <span class="n">as_timedelta</span>
<span class="n">to_isotime</span> <span class="o">=</span> <span class="n">as_isotime</span>


<span class="k">def</span> <span class="nf">_main</span><span class="p">():</span>
    <span class="n">verb</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">d0</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="s1">&#39;2010-06-21&#39;</span><span class="p">)</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="s1">&#39;2014-12-15T03:00:00.0003&#39;</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">as_datetime64</span><span class="p">(</span><span class="s1">&#39;1970-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;as&#39;</span><span class="p">)</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">as_timedelta64</span><span class="p">(</span><span class="mi">1536</span><span class="p">,</span> <span class="s1">&#39;as&#39;</span><span class="p">)</span>

    <span class="n">l0</span> <span class="o">=</span> <span class="p">[</span><span class="n">d0</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;l0&quot;</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># TEST `round_time` and `regularize_time`</span>
    <span class="c1">#</span>

    <span class="n">l1</span> <span class="o">=</span> <span class="n">regularize_time</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">l2</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">l3</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;l3&quot;</span><span class="p">,</span> <span class="n">l3</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">l4</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;l4&quot;</span><span class="p">,</span> <span class="n">l4</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">l1</span> <span class="o">==</span> <span class="n">l2</span>
    <span class="k">assert</span> <span class="n">l1</span> <span class="o">!=</span> <span class="n">l3</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">regularize_time</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PrecisionError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rounding 1536 atto secs -&gt; us should have caused an error&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">regularize_time</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">allow_rounding</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;2010-06-21 should not be representable in atto secs&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PrecisionError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rounding 1536 atto secs -&gt; secs should have caused an error&quot;</span>

    <span class="c1">#</span>
    <span class="c1"># TEST `time_sum`</span>
    <span class="c1">#</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">time_sum</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">t1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">time_sum</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">t2</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">time_sum</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">allow0</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PrecisionError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rounding 1536 atto secs -&gt; us should have caused an error&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">time_sum</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">allow_rounding</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;2010-06-21 should not be representable in atto secs&quot;</span>

    <span class="c1">#</span>
    <span class="c1"># TEST `time_diff`</span>
    <span class="c1">#</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">d1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">most_precise</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">d2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">time_diff</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">))</span>

    <span class="c1">#</span>
    <span class="c1"># TEST linspace_datetime64</span>
    <span class="c1">#</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="n">linspace_datetime64</span><span class="p">(</span><span class="n">as_datetime64</span><span class="p">(</span><span class="s1">&#39;1930-03-04&#39;</span><span class="p">),</span>
                               <span class="n">as_datetime64</span><span class="p">(</span><span class="s1">&#39;2010-02-14T12:30:00&#39;</span><span class="p">),</span>
                               <span class="mi">10</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">lst</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">_main</span><span class="p">())</span>

<span class="c1">##</span>
<span class="c1">## EOF</span>
<span class="c1">##</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018, Kristofor Maynard.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>