
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>viscid.plot.vlab &#8212; Viscid 1.0.1.dev documentation</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link rel="icon" href="../../../_static/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="../../../_static/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon-precomposed" href="../../../_static/Vicon_128.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="stylesheet" href="../../../_static/my-css.css" type="text/css" />

<script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          Viscid</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.1.dev</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
    <li class="dropdown">
      <a role="button"
         id="dLabelNavLinxToc"
         data-toggle="dropdown"
         data-target="#"
         href="#">Tutorial <b class="caret"></b></a>
      <ul class="dropdown-menu navlinktoc"
          role="menu">
          <li class="toctree-l1">
            <a class="reference internal", href="../../../installation.html">Installation</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/load_save.html">Loading & Saving</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/creating_fields.html">Creating Fields</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/slicing.html">Slicing Fields</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/plotting_scalars.html">Plotting Scalars</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/plotting_vectors.html">Plotting Vectors</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/mayavi.html">3D Plots (Mayavi)</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/openggcm.html">OpenGGCM Specific</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/ionosphere.html">Ionosphere</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/stream_and_interp.html">Streamline and Interpolation</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/magnetic_topology.html">Magnetic Topology</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/magnetopause.html">Magnetopause</a>
          </li>
          <li class="toctree-l1">
            <a class="reference internal", href="../../../tutorial/quasi_potential.html">Quasi Potential</a>
          </li>
      </ul>
    </li>

            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../indexing.html">Indexing Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../functions.html">Useful Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plot_options.html">Plot Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tips_and_tricks.html">Tips &amp; Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../custom_behavior.html">Custom Behavior (rc file)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mpl_style_gallery.html">Matplotlib Style Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_guide.html">Developerâ€™s Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/viscid.html">API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changes.html">ChangeLog</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content" role="main">
      
  <h1>Source code for viscid.plot.vlab</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Convevience module for making 3d plots with Mayavi</span>

<span class="sd">Note:</span>
<span class="sd">    You can&#39;t set rc parameters for this module!</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mayavi</span>
<span class="kn">from</span> <span class="nn">mayavi</span> <span class="k">import</span> <span class="n">mlab</span>
<span class="kn">from</span> <span class="nn">mayavi.modules.axes</span> <span class="k">import</span> <span class="n">Axes</span>
<span class="kn">from</span> <span class="nn">mayavi.sources.builtin_surface</span> <span class="k">import</span> <span class="n">BuiltinSurface</span>
<span class="kn">from</span> <span class="nn">mayavi.sources.vtk_data_source</span> <span class="k">import</span> <span class="n">VTKDataSource</span>
<span class="kn">from</span> <span class="nn">traits.trait_errors</span> <span class="k">import</span> <span class="n">TraitError</span>
<span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="k">import</span> <span class="n">tvtk</span>
<span class="kn">import</span> <span class="nn">viscid</span>
<span class="kn">from</span> <span class="nn">viscid</span> <span class="k">import</span> <span class="n">NOT_SPECIFIED</span>
<span class="kn">from</span> <span class="nn">viscid</span> <span class="k">import</span> <span class="n">field</span>


<span class="c1"># anything placed in here is not multiprocessing-safe</span>
<span class="n">_global_ns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>


<div class="viewcode-block" id="add_source"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.add_source">[docs]</a><span class="k">def</span> <span class="nf">add_source</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a vtk data source to a figure</span>

<span class="sd">    Args:</span>
<span class="sd">        src (VTKDataSource): Description</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">figure</span><span class="p">:</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">src</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figure</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="n">engine</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">engine</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">scene</span><span class="o">=</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">src</span></div>

<div class="viewcode-block" id="add_lines"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.add_lines">[docs]</a><span class="k">def</span> <span class="nf">add_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NoName&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add list of lines to a figure</span>

<span class="sd">    Args:</span>
<span class="sd">        lines (list): See :py:func:`lines2source`</span>
<span class="sd">        scalars (ndarray): See :py:func:`lines2source`</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>
<span class="sd">        name (str): name of vtk object</span>

<span class="sd">    Returns:</span>
<span class="sd">        :py:class:`mayavi.sources.vtk_data_source.VTKDataSource`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">lines2source</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">add_source</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">src</span></div>

<div class="viewcode-block" id="add_field"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.add_field">[docs]</a><span class="k">def</span> <span class="nf">add_field</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a Viscid Field to a mayavi figure</span>

<span class="sd">    Args:</span>
<span class="sd">        fld (Field): Some Viscid Field</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>
<span class="sd">        center (str): &#39;cell&#39; or &#39;node&#39;, leave blank to use fld.center</span>
<span class="sd">        name (str): name of vtk object, leave black for fld.name</span>

<span class="sd">    Returns:</span>
<span class="sd">        :py:class:`mayavi.sources.vtk_data_source.VTKDataSource`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">field2source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">add_source</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">src</span></div>

<div class="viewcode-block" id="points2source"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.points2source">[docs]</a><span class="k">def</span> <span class="nf">points2source</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NoName&quot;</span><span class="p">):</span>
    <span class="c1"># if scalars:</span>
    <span class="c1">#     scalars = [scalars]</span>
    <span class="n">verts</span><span class="p">,</span> <span class="n">scalars</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="n">viscid</span><span class="o">.</span><span class="n">vutil</span><span class="o">.</span><span class="n">prepare_lines</span><span class="p">([</span><span class="n">vertices</span><span class="p">],</span> <span class="n">scalars</span><span class="p">)</span>

    <span class="n">src</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_scatter</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">scalars</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;u1&#39;</span><span class="p">):</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">UnsignedCharArray</span><span class="p">()</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">scalars</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">sc</span>
        <span class="n">src</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span> <span class="o">=</span> <span class="n">scalars</span>
        <span class="n">src</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">modified</span><span class="p">()</span>
    <span class="n">src</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">src</span></div>

<div class="viewcode-block" id="lines2source"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.lines2source">[docs]</a><span class="k">def</span> <span class="nf">lines2source</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NoName&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turn a list of lines as ndarrays into vtk data source</span>

<span class="sd">    Args:</span>
<span class="sd">        lines (list): List of 3xN, 4xN, 6xN ndarrays of xyz, xyzs, or</span>
<span class="sd">            xyzrgb data for N points along the line. N need not be the</span>
<span class="sd">            same for all lines.</span>
<span class="sd">        scalars (ndarray, list): Scalars for each point, or each line.</span>
<span class="sd">            See :py:func:`viscid.vutil.prepare_lines` for more details</span>
<span class="sd">        name (str): name of vtk object</span>

<span class="sd">    Returns:</span>
<span class="sd">        :py:class:`mayavi.sources.vtk_data_source.VTKDataSource`</span>

<span class="sd">    See Also:</span>
<span class="sd">        * :py:func:`viscid.vutil.prepare_lines`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">viscid</span><span class="o">.</span><span class="n">vutil</span><span class="o">.</span><span class="n">prepare_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">scalars</span><span class="p">,</span> <span class="n">do_connections</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lines</span><span class="p">,</span> <span class="n">scalars</span><span class="p">,</span> <span class="n">connections</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="n">r</span>

    <span class="c1"># FIXME: the following branch is a workaround for Mayavi &gt;= 4.7.0</span>
    <span class="c1"># For some reason, setting scalar point data after source creation</span>
    <span class="c1"># now has an issue where mayavi doesn&#39;t autoscale the lut correctly.</span>
    <span class="c1"># This has something to do with changes in supporting composite data in</span>
    <span class="c1"># Mayavi commit:</span>
    <span class="c1"># https://github.com/enthought/mayavi/commit/fd9a515a9563d81a42b84514c1fb4ce5f81ac9a0</span>
    <span class="c1">#</span>
    <span class="c1"># So... if scalars are color values (set by hex or rgb), then we have to</span>
    <span class="c1"># set the point data by hand. This is ok since the lut range won&#39;t be</span>
    <span class="c1"># needed. Otherwise, just pass the scalars on source creation.</span>
    <span class="k">if</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">scalars</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;u1&#39;</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">line_source</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">UnsignedCharArray</span><span class="p">()</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">scalars</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="n">sc</span>
        <span class="n">src</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span> <span class="o">=</span> <span class="n">scalars</span>
        <span class="n">src</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">modified</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">line_source</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">scalars</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">line_source</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">src</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">connections</span>
    <span class="n">src</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">src</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">src</span></div>

<div class="viewcode-block" id="field2source"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.field2source">[docs]</a><span class="k">def</span> <span class="nf">field2source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a field to a vtk data source</span>

<span class="sd">    This dispatches to either :meth:`field_to_point_source` or</span>
<span class="sd">    :meth:`field_to_cell_source` depending on the centering of</span>
<span class="sd">    `fld`.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        fld: field to convert</span>
<span class="sd">        center (str): Either &quot;cell&quot;, &quot;node&quot;, or &quot;&quot; to use the</span>
<span class="sd">            same centering as fld</span>
<span class="sd">        name (str): Add specific name. Leave as &quot;&quot; to use fld.name</span>

<span class="sd">    Returns:</span>
<span class="sd">        mayavi source</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If center (or fld.center) is not</span>
<span class="sd">            recognized</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">center</span><span class="p">:</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">center</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">center</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">center</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">field2point_source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">center</span> <span class="o">==</span> <span class="s2">&quot;cell&quot;</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">field2cell_source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;cell / node only for now&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">src</span></div>

<div class="viewcode-block" id="field2point_source"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.field2point_source">[docs]</a><span class="k">def</span> <span class="nf">field2point_source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a field to a vtk point data source&quot;&quot;&quot;</span>
    <span class="n">grid</span><span class="p">,</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">_prep_field</span><span class="p">(</span><span class="n">fld</span><span class="p">)</span>
    <span class="n">dat_target</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">point_data</span>

    <span class="k">if</span> <span class="n">fld</span><span class="o">.</span><span class="n">iscentered</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">):</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">crds</span><span class="o">.</span><span class="n">shape_cc</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">x_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_cc</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># (&#39;x&#39;)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">y_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_cc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (&#39;y&#39;)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">z_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_cc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># (&#39;z&#39;)</span>
    <span class="k">elif</span> <span class="n">fld</span><span class="o">.</span><span class="n">iscentered</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">):</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">crds</span><span class="o">.</span><span class="n">shape_nc</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">x_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_nc</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># (&#39;x&#39;)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">y_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (&#39;y&#39;)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">z_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_nc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># (&#39;z&#39;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cell or node only please&quot;</span><span class="p">)</span>

    <span class="n">src</span> <span class="o">=</span> <span class="n">_finalize_source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">dat_target</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">src</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">src</span></div>

<div class="viewcode-block" id="field2cell_source"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.field2cell_source">[docs]</a><span class="k">def</span> <span class="nf">field2cell_source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a field to a vtk cell data source&quot;&quot;&quot;</span>
    <span class="n">grid</span><span class="p">,</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">_prep_field</span><span class="p">(</span><span class="n">fld</span><span class="p">)</span>
    <span class="n">dat_target</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">cell_data</span>

    <span class="k">if</span> <span class="n">fld</span><span class="o">.</span><span class="n">iscentered</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">):</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">crds</span><span class="o">.</span><span class="n">shape_nc</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">x_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_nc</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># (&#39;x&#39;)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">y_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_nc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (&#39;y&#39;)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">z_coordinates</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">get_crd_nc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># (&#39;z&#39;)</span>
    <span class="k">elif</span> <span class="n">fld</span><span class="o">.</span><span class="n">iscentered</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;can&#39;t do lossless cell data from nodes yet&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cell or node only please&quot;</span><span class="p">)</span>

    <span class="n">src</span> <span class="o">=</span> <span class="n">_finalize_source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">dat_target</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">src</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">src</span></div>


<span class="k">def</span> <span class="nf">_prep_field</span><span class="p">(</span><span class="n">fld</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">RectilinearGrid</span><span class="p">()</span>

    <span class="c1"># note, the transpose operations are b/c fld.data is now xyz ordered,</span>
    <span class="c1"># but vtk expects zyx data</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">ScalarField</span><span class="p">):</span>
        <span class="n">zyx_dat</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">zyx_dat</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>
        <span class="c1"># vtk expects zyx data, but fld.data is now xyz</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">VectorField</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fld</span><span class="o">.</span><span class="n">layout</span> <span class="o">==</span> <span class="n">field</span><span class="o">.</span><span class="n">LAYOUT_INTERLACED</span><span class="p">:</span>
            <span class="n">zyx_dat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">zyx_dat</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">fld</span><span class="o">.</span><span class="n">layout</span> <span class="o">==</span> <span class="n">field</span><span class="o">.</span><span class="n">LAYOUT_FLAT</span><span class="p">:</span>
            <span class="n">zyx_dat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">zyx_dat</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">shape</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected fld type: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fld</span><span class="p">)))</span>
    <span class="c1"># swap endian if needed</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">grid</span><span class="p">,</span> <span class="n">arr</span>

<span class="k">def</span> <span class="nf">_finalize_source</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">dat_target</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">ScalarField</span><span class="p">):</span>
        <span class="n">dat_target</span><span class="o">.</span><span class="n">scalars</span> <span class="o">=</span> <span class="n">arr</span>
        <span class="n">dat_target</span><span class="o">.</span><span class="n">scalars</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">name</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">VectorField</span><span class="p">):</span>
        <span class="n">dat_target</span><span class="o">.</span><span class="n">vectors</span> <span class="o">=</span> <span class="n">arr</span>
        <span class="n">dat_target</span><span class="o">.</span><span class="n">vectors</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">name</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">VTKDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">src</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">name</span>
    <span class="k">return</span> <span class="n">src</span>

<span class="k">def</span> <span class="nf">_prep_vector_source</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="n">scalars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Side-effect: v_src will be modified if scalars are given&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="n">viscid</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">v_src</span> <span class="o">=</span> <span class="n">field2source</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">viscid</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">field2source</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">)</span>
        <span class="n">v_src</span><span class="o">.</span><span class="n">_point_scalars_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scalars</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="n">v_src</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span> <span class="o">=</span> <span class="n">scalars</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span>
        <span class="n">v_src</span><span class="o">.</span><span class="n">point_scalars_name</span> <span class="o">=</span> <span class="n">scalars</span><span class="o">.</span><span class="n">name</span>
    <span class="k">return</span> <span class="n">v_src</span><span class="p">,</span> <span class="n">scalars</span>

<div class="viewcode-block" id="scalar_cut_plane"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.scalar_cut_plane">[docs]</a><span class="k">def</span> <span class="nf">scalar_cut_plane</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps `mayavi.mlab.pipeline.scalar_cut_plane`</span>

<span class="sd">    Note:</span>
<span class="sd">        This function will automatically switch to the default</span>
<span class="sd">        Matplotlib colormap (or the one from your viscidrc file)</span>

<span class="sd">        If you call this multiple times with the same</span>
<span class="sd">        `viscid.field.Field`, you should consider using field2source</span>
<span class="sd">        yourself and passing the Mayavi source object</span>

<span class="sd">    Args:</span>
<span class="sd">        src (Mayavi Source or ScalarField): If src is a ScalarField,</span>
<span class="sd">            then the field is wrapped into a Mayavi Source and added</span>
<span class="sd">            to the figure</span>
<span class="sd">        center (str): centering for the Mayavi source, &#39;cell&#39; will</span>
<span class="sd">            make the grid visible, while &#39;node&#39; will interpolate</span>
<span class="sd">            between points</span>
<span class="sd">        **kwargs: Passed to `mayavi.mlab.pipeline.scalar_cut_plane`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        `mayavi.modules.scalar_cut_plane.ScalarCutPlane`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">viscid</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">field2source</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">scp</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_cut_plane</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">scp</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scp</span></div>

<div class="viewcode-block" id="vector_cut_plane"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.vector_cut_plane">[docs]</a><span class="k">def</span> <span class="nf">vector_cut_plane</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_mode</span><span class="o">=</span><span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps `mayavi.mlab.pipeline.vector_cut_plane`</span>

<span class="sd">    Note:</span>
<span class="sd">        This function will automatically switch to the default</span>
<span class="sd">        Matplotlib colormap (or the one from your viscidrc file)</span>

<span class="sd">        If you call this multiple times with the same</span>
<span class="sd">        `viscid.field.Field`, you should consider using field2source</span>
<span class="sd">        yourself and passing the Mayavi source object</span>

<span class="sd">    Args:</span>
<span class="sd">        v_src (Mayavi Source, or VectorField): Vector to cut-plane. If</span>
<span class="sd">            a Mayavi Source, then it must be node centered.</span>
<span class="sd">        scalars (Mayavi Source, or ScalarField): Optional scalar data.</span>
<span class="sd">            If a Mayavi Source, then it must be node centered. This</span>
<span class="sd">            will enable scale_mode and color_mode by &#39;scalar&#39;</span>
<span class="sd">        color_mode (str): Color by &#39;vector&#39;, &#39;scalar&#39;, or &#39;none&#39;</span>
<span class="sd">        **kwargs: Passed to `mayavi.mlab.pipeline.vector_cut_plane`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        `mayavi.modules.vector_cut_plane.VectorCutPlane`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v_src</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">_prep_vector_source</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="n">scalars</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">vcp</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">vector_cut_plane</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">vcp</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">vcp</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>

    <span class="n">vcp</span><span class="o">.</span><span class="n">glyph</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">=</span> <span class="s1">&#39;color_by_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">color_mode</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">vcp</span></div>

<div class="viewcode-block" id="mesh_from_seeds"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.mesh_from_seeds">[docs]</a><span class="k">def</span> <span class="nf">mesh_from_seeds</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_holes</span><span class="o">=</span><span class="n">NOT_SPECIFIED</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps `mayavi.mlab.mesh` for Viscid seed generators</span>

<span class="sd">    Note:</span>
<span class="sd">        This function will automatically switch to the default</span>
<span class="sd">        Matplotlib colormap (or the one from your viscidrc file)</span>

<span class="sd">    Args:</span>
<span class="sd">        seeds (Viscid.SeedGen): Some seed generator with a 2D mesh</span>
<span class="sd">            representation</span>
<span class="sd">        scalars (ndarray, ScalarField): data mapped onto the mesh,</span>
<span class="sd">            i.e., the result of viscid.interp_trilin(seeds, ...)</span>
<span class="sd">        **kwargs: Passed to `mayavi.mlab.mesh`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        `mayavi.modules.surface.Surface`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vertices</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">seeds</span><span class="o">.</span><span class="n">wrap_mesh</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">fill_holes</span><span class="o">=</span><span class="n">fill_holes</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vertices</span><span class="p">,</span> <span class="o">=</span> <span class="n">seeds</span><span class="o">.</span><span class="n">wrap_mesh</span><span class="p">(</span><span class="n">fill_holes</span><span class="o">=</span><span class="n">fill_holes</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.mesh">[docs]</a><span class="k">def</span> <span class="nf">mesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps `mayavi.mlab.mesh`</span>

<span class="sd">    Note:</span>
<span class="sd">        This function will automatically switch to the default</span>
<span class="sd">        Matplotlib colormap (or the one from your viscidrc file)</span>

<span class="sd">    Args:</span>
<span class="sd">        x (TYPE): 2D array of vertices&#39; x-values</span>
<span class="sd">        y (TYPE): 2D array of vertices&#39; y-values</span>
<span class="sd">        z (TYPE): 2D array of vertices&#39; z-values</span>
<span class="sd">        scalars (ndarray, ScalarField): optional scalar data</span>
<span class="sd">        **kwargs: Passed to `mayavi.mlab.mesh`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        `mayavi.modules.surface.Surface`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">viscid</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">scalars</span><span class="o">.</span><span class="n">data</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="n">scalars</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">apply_cmap</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="quiver3d"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.quiver3d">[docs]</a><span class="k">def</span> <span class="nf">quiver3d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps `mayavi.mlab.quiver3d`</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: passed to `mayavi.mlab.quiver3d`</span>
<span class="sd">        **kwargs: Other Arguments are popped, then kwargs is passed to</span>
<span class="sd">            `mayavi.mlab.quiver3d`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        TYPE: Description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">quivers</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">quiver3d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">quivers</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">quivers</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">quivers</span></div>

<div class="viewcode-block" id="points3d"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.points3d">[docs]</a><span class="k">def</span> <span class="nf">points3d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps `mayavi.mlab.points3d`</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: passed to `mayavi.mlab.points3d`</span>
<span class="sd">        **kwargs: Other Arguments are popped, then kwargs is passed to</span>
<span class="sd">            `mayavi.mlab.points3d`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        modify_args (bool): if True (default), then check if args is a</span>
<span class="sd">            single 2d sequence of shape 3xN or Nx3. Then split them up</span>
<span class="sd">            appropriately. if False, then args are passed through</span>
<span class="sd">            to mlab.points3d unchanged, nomatter what.</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        TYPE: Description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modify_args</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;modify_args&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">modify_args</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">a0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">a0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">a0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">a0</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">a0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">a0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">a0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">a0</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">a0</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">points</span></div>

<div class="viewcode-block" id="streamline"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.streamline">[docs]</a><span class="k">def</span> <span class="nf">streamline</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps `mayavi.mlab.pipeline.streamline`; mind the caveats</span>

<span class="sd">    Note:</span>
<span class="sd">        This function will automatically switch to the default</span>
<span class="sd">        Matplotlib colormap (or the one from your viscidrc file)</span>

<span class="sd">        Side-effect: If scalars are given, then v_src is modified to</span>
<span class="sd">        point to the scalar data!</span>

<span class="sd">        If v_src and scalars are Mayavi sources, they must be node</span>
<span class="sd">        centered.</span>

<span class="sd">        If you call this multiple times with the same v_src and</span>
<span class="sd">        scalars, you should consider using field2source yourself and</span>
<span class="sd">        passing the Mayavi source objects, unless you&#39;re using</span>
<span class="sd">        different scalars with the same vector field, since this</span>
<span class="sd">        function has side-effects on the vector sourc.</span>

<span class="sd">    Args:</span>
<span class="sd">        v_src (Mayavi Source, or VectorField): Vector to streamline. If</span>
<span class="sd">            a Mayavi Source, then it must be node centered.</span>
<span class="sd">        scalars (Mayavi Source, or ScalarField): Optional scalar data.</span>
<span class="sd">            If a Mayavi Source, then it must be node centered.</span>
<span class="sd">        **kwargs: Passed to `mayavi.mlab.mesh`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        `mayavi.modules.streamline.Streamline`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v_src</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">_prep_vector_source</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="n">scalars</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">sl</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">streamline</span><span class="p">(</span><span class="n">v_src</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sl</span></div>

<div class="viewcode-block" id="iso_surface"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.iso_surface">[docs]</a><span class="k">def</span> <span class="nf">iso_surface</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">backface_culling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps `mayavi.mlab.pipeline.iso_surface`; mind the caveats</span>

<span class="sd">    Note that backfaces are culled by default.</span>

<span class="sd">    Note:</span>
<span class="sd">        This function will automatically switch to the default</span>
<span class="sd">        Matplotlib colormap (or the one from your viscidrc file)</span>

<span class="sd">        If src is a Mayavi source, it must be node centered.</span>

<span class="sd">        If you call this multiple times with the same</span>
<span class="sd">        `viscid.field.Field`, you should consider using field2source</span>
<span class="sd">        yourself and passing the Mayavi source object</span>

<span class="sd">    Args:</span>
<span class="sd">        src (Mayavi Source or ScalarField): If src is a ScalarField,</span>
<span class="sd">            then the field is wrapped into a Mayavi Source and added</span>
<span class="sd">            to the figure. If a Mayavi Source, then it must be node</span>
<span class="sd">            centered.</span>
<span class="sd">        backface_culling (bool): Cull backfaces by default. Useful for</span>
<span class="sd">            translucent surfaces.</span>
<span class="sd">        **kwargs: Passed to `mayavi.mlab.pipeline.scalar_cut_plane`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        `mayavi.modules.iso_surface.IsoSurface`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">viscid</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">field2source</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">iso</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">iso_surface</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">iso</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="n">iso</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">backface_culling</span> <span class="o">=</span> <span class="n">backface_culling</span>
    <span class="k">return</span> <span class="n">iso</span></div>

<div class="viewcode-block" id="plot_line"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.plot_line">[docs]</a><span class="k">def</span> <span class="nf">plot_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrap :py:func:`plot_lines` for a single line&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="p">[</span><span class="n">scalars</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">plot_lines</span><span class="p">([</span><span class="n">line</span><span class="p">],</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_lines"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.plot_lines">[docs]</a><span class="k">def</span> <span class="nf">plot_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;tube&quot;</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Lines&quot;</span><span class="p">,</span> <span class="n">tube_radius</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">tube_sides</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make 3D mayavi plot of lines</span>

<span class="sd">    Scalars can be a bunch of single values, or a bunch of rgb data</span>
<span class="sd">    to set the color of each line / vertex explicitly. This is</span>
<span class="sd">    explained in :py:func:`lines2source`.</span>

<span class="sd">    Example:</span>
<span class="sd">        A common use case of setting the line color from a topology</span>
<span class="sd">        will want to use :py:func:`viscid.topology2color`::</span>

<span class="sd">            &gt;&gt;&gt; import viscid</span>
<span class="sd">            &gt;&gt;&gt; from viscid.plot import vlab</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; B = viscid.make_dipole()</span>
<span class="sd">            &gt;&gt;&gt; seeds = viscid.Line([-4, 0, 0], [4, 0, 0])</span>
<span class="sd">            &gt;&gt;&gt; lines, topology = viscid.calc_streamlines(B, seeds,</span>
<span class="sd">            &gt;&gt;&gt;                                           ibound=0.05)</span>
<span class="sd">            &gt;&gt;&gt; scalars = viscid.topology2color(topology)</span>
<span class="sd">            &gt;&gt;&gt; vlab.plot_lines(lines, scalars, tube_radius=0.02)</span>
<span class="sd">            &gt;&gt;&gt; vlab.savefig(&quot;dipole.x3d&quot;)</span>
<span class="sd">            &gt;&gt;&gt; viscid.meshlab_convert(&quot;dipole.x3d&quot;, &quot;dae&quot;)</span>
<span class="sd">            &gt;&gt;&gt; vlab.show()</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lines (list): See :py:func:`lines2source`</span>
<span class="sd">        scalars (TYPE): See :py:func:`lines2source`</span>
<span class="sd">        style (str): &#39;tube&#39; or &#39;none&#39;</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>
<span class="sd">        name (str): Description</span>
<span class="sd">        tube_radius (float): Radius if style == &#39;tube&#39;</span>
<span class="sd">        tube_sides (int): Angular resolution if style == &#39;tube&#39;</span>
<span class="sd">        **kwargs: passed to :meth:`mayavi.mlab.pipeline.surface`. This</span>
<span class="sd">            is useful for setting a colormap among other things.</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    Returns:</span>
<span class="sd">        Mayavi surface module</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if style is neither tube nor strip</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">figure</span><span class="p">:</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

    <span class="n">src</span> <span class="o">=</span> <span class="n">lines2source</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">scalars</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># always use the stripper since actually turns a collection of line</span>
    <span class="c1"># segments into a line... that way capping will cap lines, not line</span>
    <span class="c1"># segments, etc.</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">stripper</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;tube&quot;</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">tube</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="n">tube_radius</span><span class="o">=</span><span class="n">tube_radius</span><span class="p">,</span>
                                   <span class="n">tube_sides</span><span class="o">=</span><span class="n">tube_sides</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">style</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown style for lines: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>

    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">surface</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">surface</span></div>

<div class="viewcode-block" id="plot_ionosphere"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.plot_ionosphere">[docs]</a><span class="k">def</span> <span class="nf">plot_ionosphere</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.063</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bounding_lat</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">rotate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crd_system</span><span class="o">=</span><span class="s2">&quot;gse&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot an ionospheric field</span>

<span class="sd">    Args:</span>
<span class="sd">        fld (Field): Some spherical (phi, theta) / (lot, lat) field</span>
<span class="sd">        radius (float): Defaults to 1Re + 400km == 1.063Re</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>
<span class="sd">        bounding_lat (float): Description</span>
<span class="sd">        rotate (None, sequence, str, datetime64): sequence of length 4</span>
<span class="sd">            that contains (angle, ux, uy, uz) for the angle and axis of</span>
<span class="sd">            a rotation, or a UT time as string or datetime64 to rotate</span>
<span class="sd">            earth to a specific date/time, or a cotr object in</span>
<span class="sd">            conjunction with crd_system</span>
<span class="sd">        crd_system (str, other): Used if rotate is datetime-like. Can</span>
<span class="sd">            be one of (&#39;gse&#39;, &#39;mhd&#39;), or anything that returns from</span>
<span class="sd">            :py:func:`viscid.as_crd_system`.</span>
<span class="sd">        **kwargs: passed to :py:func:`mayavi.mlab.mesh`</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        cmap (str, None, False): see :py:func:`apply_cmap`</span>
<span class="sd">        alpha (number, sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        clim (sequence): see :py:func:`apply_cmap`</span>
<span class="sd">        symmetric (bool): see :py:func:`apply_cmap`</span>
<span class="sd">        logscale (bool): see :py:func:`apply_cmap`</span>

<span class="sd">    No Longer Raises:</span>
<span class="sd">        ValueError: Description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

    <span class="n">fld</span> <span class="o">=</span> <span class="n">viscid</span><span class="o">.</span><span class="n">as_spherefield</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
    <span class="n">phil</span><span class="p">,</span> <span class="n">thetal</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">xl</span>
    <span class="n">phih</span><span class="p">,</span> <span class="n">thetah</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">xh</span>
    <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">sphere</span> <span class="o">=</span> <span class="n">viscid</span><span class="o">.</span><span class="n">Sphere</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">ntheta</span><span class="o">=</span><span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="o">=</span><span class="n">nphi</span><span class="p">,</span>
                           <span class="n">thetalim</span><span class="o">=</span><span class="p">(</span><span class="n">thetal</span><span class="p">,</span> <span class="n">thetah</span><span class="p">),</span> <span class="n">philim</span><span class="o">=</span><span class="p">(</span><span class="n">phil</span><span class="p">,</span> <span class="n">phih</span><span class="p">),</span>
                           <span class="n">theta_phi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">verts</span><span class="p">,</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">sphere</span><span class="o">.</span><span class="n">wrap_mesh</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">fill_holes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fld</span><span class="o">.</span><span class="n">name</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">scalars</span><span class="o">=</span><span class="n">arr</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">splitting</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">bounding_lat</span><span class="p">:</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">radius</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">bounding_lat</span><span class="p">)</span>
        <span class="n">clip</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">data_set_clipper</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">module_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">clip</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">place_widget</span><span class="p">(</span><span class="o">-</span><span class="n">rp</span><span class="p">,</span> <span class="n">rp</span><span class="p">,</span> <span class="o">-</span><span class="n">rp</span><span class="p">,</span> <span class="n">rp</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">clip</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>
        <span class="n">clip</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">insert_filter</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">module_manager</span><span class="p">)</span>
        <span class="c1"># m.module_manager.parent.parent.filter.auto_orient_normals = True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
        <span class="c1"># m.module_manager.parent.filter.auto_orient_normals = True</span>
    <span class="n">m</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">interpolate_scalars_before_mapping</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">_apply_rotation</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">&#39;sm&#39;</span><span class="p">,</span> <span class="n">rotate</span><span class="p">,</span> <span class="n">crd_system</span><span class="o">=</span><span class="n">crd_system</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="plot_nulls"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.plot_nulls">[docs]</a><span class="k">def</span> <span class="nf">plot_nulls</span><span class="p">(</span><span class="n">nulls</span><span class="p">,</span> <span class="n">Acolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.263</span><span class="p">,</span> <span class="mf">0.345</span><span class="p">),</span> <span class="n">Bcolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.686</span><span class="p">,</span> <span class="mf">0.314</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
               <span class="n">Ocolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.239</span><span class="p">,</span> <span class="mf">0.659</span><span class="p">,</span> <span class="mf">0.557</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;scale_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;scale_factor&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nulls</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">nulls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">O</span><span class="o">=</span><span class="p">[</span><span class="n">empty</span><span class="p">,</span> <span class="n">nulls</span><span class="p">],</span> <span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="n">empty</span><span class="p">,</span> <span class="n">empty</span><span class="p">],</span> <span class="n">B</span><span class="o">=</span><span class="p">[</span><span class="n">empty</span><span class="p">,</span> <span class="n">empty</span><span class="p">])</span>

    <span class="n">Opts</span> <span class="o">=</span> <span class="n">nulls</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Ocolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Opts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Opts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Opts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">Ocolor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Onulls&quot;</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">Apts</span> <span class="o">=</span> <span class="n">nulls</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Ocolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Opts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span><span class="n">Apts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Apts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Apts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">Acolor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Anulls&quot;</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">Bpts</span> <span class="o">=</span> <span class="n">nulls</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Bcolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Bpts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span><span class="n">Bpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Bpts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Bpts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">Bcolor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bnulls&quot;</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="fancy_axes"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.fancy_axes">[docs]</a><span class="k">def</span> <span class="nf">fancy_axes</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nb_labels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">tight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">symmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
               <span class="n">face_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">grid_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label_shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">consolidate_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make axes with 3 shaded walls and a grid similar to matplotlib</span>

<span class="sd">    Args:</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>
<span class="sd">        target (Mayavi Element): If either xl or xh are not given, then</span>
<span class="sd">            get that limit from a bounding box around `target`</span>
<span class="sd">        nb_labels (int, sequence): number of labels in all, or each</span>
<span class="sd">            (x, y, z) directions</span>
<span class="sd">        xl (float, sequence): lower corner of axes</span>
<span class="sd">        xh (float, sequence): upper corner of axes</span>
<span class="sd">        tight (bool): If False, then let xl and xh expand to make nicer</span>
<span class="sd">            labels. This uses matplotlib to determine new extrema</span>
<span class="sd">        symmetric (bool): If True, then xl + xh = 0</span>
<span class="sd">        padding (float): add padding as a fraction of the total length</span>
<span class="sd">        opacity (float): opacity of faces</span>
<span class="sd">        face_color (sequence): color (r, g, b) of faces</span>
<span class="sd">        line_width (float): Width of grid lines</span>
<span class="sd">        grid_color (sequence): Color of grid lines</span>
<span class="sd">        labels (bool): Whether or not to put axis labels on</span>
<span class="sd">        label_color (sequence): color of axis labels</span>
<span class="sd">        label_shadow (bool): Add shadows to all labels</span>
<span class="sd">        consolidate_labels (bool): if all nb_labels are the same, then</span>
<span class="sd">            only make one axis for the labels</span>

<span class="sd">    Returns:</span>
<span class="sd">        VTKDataSource: source to which 2 surfaces and 3 axes belong</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

    <span class="c1"># setup xl and xh</span>
    <span class="k">if</span> <span class="n">xl</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">xh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_outline</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">outline</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xl</span> <span class="o">=</span> <span class="n">_outline</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xh</span> <span class="o">=</span> <span class="n">_outline</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">_outline</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">nb_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">nb_labels</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
    <span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)))</span>
    <span class="n">xh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">xh</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)))</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">xh</span> <span class="o">-</span> <span class="n">xl</span>

    <span class="n">xl</span> <span class="o">-=</span> <span class="n">padding</span> <span class="o">*</span> <span class="n">L</span>
    <span class="n">xh</span> <span class="o">+=</span> <span class="n">padding</span> <span class="o">*</span> <span class="n">L</span>

    <span class="c1"># now adjust xl and xh to be prettier</span>
    <span class="k">if</span> <span class="n">symmetric</span><span class="p">:</span>
        <span class="n">tight</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tight</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">AutoLocator</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xl</span><span class="p">)):</span>  <span class="c1"># pylint: disable=consider-using-enumerate</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">AutoLocator</span><span class="p">()</span>
            <span class="n">l</span><span class="o">.</span><span class="n">create_dummy_axis</span><span class="p">()</span>
            <span class="n">l</span><span class="o">.</span><span class="n">set_view_interval</span><span class="p">(</span><span class="n">xl</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xh</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="n">l</span><span class="p">()</span>
            <span class="n">xl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xh</span> <span class="o">-</span> <span class="n">xl</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nb_labels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">ImageData</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="n">nb_labels</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">xl</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">VTKDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">src</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;fancy_axes&quot;</span>

    <span class="k">if</span> <span class="n">face_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">face_color</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">background</span>
    <span class="k">if</span> <span class="n">grid_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grid_color</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">foreground</span>
    <span class="k">if</span> <span class="n">label_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label_color</span> <span class="o">=</span> <span class="n">grid_color</span>

    <span class="n">face</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">face_color</span><span class="p">)</span>
    <span class="n">face</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">frontface_culling</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">line_width</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="n">grid_color</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                                     <span class="n">representation</span><span class="o">=</span><span class="s1">&#39;wireframe&#39;</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">frontface_culling</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">_make_ax_for_labels</span><span class="p">(</span><span class="n">_i</span><span class="p">,</span> <span class="n">all_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">all_axes</span><span class="p">:</span>
                <span class="n">_ax</span> <span class="o">=</span> <span class="n">Axes</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;axes-labels&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_ax</span> <span class="o">=</span> <span class="n">Axes</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-axis-labels&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;xyz&#39;</span><span class="p">[</span><span class="n">_i</span><span class="p">]))</span>
                <span class="c1"># VTK bug... y_axis and z_axis are flipped... how is VTK still</span>
                <span class="c1"># the de-facto 3d plotting library?</span>
                <span class="k">if</span> <span class="n">_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">x_axis_visibility</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">y_axis_visibility</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">z_axis_visibility</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">_i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">x_axis_visibility</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">y_axis_visibility</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">z_axis_visibility</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># VTK bug</span>
                <span class="k">elif</span> <span class="n">_i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">x_axis_visibility</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">y_axis_visibility</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># VTK bug</span>
                    <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">z_axis_visibility</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
            <span class="n">_ax</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">_ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">number_of_labels</span> <span class="o">=</span> <span class="n">nb_labels</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span>
            <span class="c1"># import IPython; IPython.embed()</span>
            <span class="n">_ax</span><span class="o">.</span><span class="n">title_text_property</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">label_color</span>
            <span class="n">_ax</span><span class="o">.</span><span class="n">title_text_property</span><span class="o">.</span><span class="n">shadow</span> <span class="o">=</span> <span class="n">label_shadow</span>
            <span class="n">_ax</span><span class="o">.</span><span class="n">label_text_property</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">label_color</span>
            <span class="n">_ax</span><span class="o">.</span><span class="n">label_text_property</span><span class="o">.</span><span class="n">shadow</span> <span class="o">=</span> <span class="n">label_shadow</span>
            <span class="n">src</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="n">_ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">consolidate_labels</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">nb_labels</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">nb_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">_make_ax_for_labels</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">all_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_make_ax_for_labels</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">all_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">_make_ax_for_labels</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">all_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">_make_ax_for_labels</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">all_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">src</span></div>

<span class="n">axes</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">axes</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">xlabel</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">ylabel</span>
<span class="n">zlabel</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">zlabel</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">title</span>
<span class="n">outline</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">outline</span>
<span class="n">orientation_axes</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">orientation_axes</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">view</span>

<span class="k">def</span> <span class="nf">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">cmap_kwargs</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cmap_kwargs</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cmap_kwargs</span><span class="p">[</span><span class="s2">&quot;clim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;clim&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cmap_kwargs</span><span class="p">[</span><span class="s2">&quot;symmetric&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;symmetric&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">cmap_kwargs</span><span class="p">[</span><span class="s2">&quot;logscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;logscale&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span>

<div class="viewcode-block" id="colorbar"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.colorbar">[docs]</a><span class="k">def</span> <span class="nf">colorbar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps mayavi.mlab.colorbar and adjusts cmap if you so choose&quot;&quot;&quot;</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">cmap_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="scalarbar"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.scalarbar">[docs]</a><span class="k">def</span> <span class="nf">scalarbar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps mayavi.mlab.scalarbar and adjusts cmap if you so choose&quot;&quot;&quot;</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">cmap_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">scalarbar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="vectorbar"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.vectorbar">[docs]</a><span class="k">def</span> <span class="nf">vectorbar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps mayavi.mlab.vectorbar and adjusts cmap if you so choose&quot;&quot;&quot;</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">,</span> <span class="n">cmap_kwargs</span> <span class="o">=</span> <span class="n">_extract_cmap_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">cmap_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">vectorbar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">apply_cmap</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="get_cmap"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.get_cmap">[docs]</a><span class="k">def</span> <span class="nf">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a Matplotlib colormap as an rgba ndarray</span>

<span class="sd">    Args:</span>
<span class="sd">        cmap (str): name of colormap, or an ndarray of rgb(a) colors</span>
<span class="sd">        lut (int): number of entries desired in the lookup table</span>

<span class="sd">    Returns:</span>
<span class="sd">        ndarray: Nx4 array of N rgba colors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="k">if</span> <span class="n">symmetric</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cmap</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;viscid.symmetric_cmap&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="n">lut</span><span class="p">)</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cm</span><span class="o">.</span><span class="n">N</span><span class="p">))))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">rgba</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">rgba</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="n">rgba</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">rgba</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rgba</span> <span class="o">=</span> <span class="n">rgba</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">rgba</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">rgba</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cmap ndarray must have color values between &quot;</span>
                                 <span class="s2">&quot;0 and 255 or 0.0 and 1.0&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rgba</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rgba</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rgba</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rgba</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">rgba</span><span class="p">,</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">rgba</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">])])</span>

    <span class="k">return</span> <span class="n">rgba</span></div>

<div class="viewcode-block" id="apply_cmap"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.apply_cmap">[docs]</a><span class="k">def</span> <span class="nf">apply_cmap</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">,</span>
               <span class="n">clim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Apply a Matplotlib colormap to a Mayavi object &amp; adjust limits</span>

<span class="sd">    Args:</span>
<span class="sd">        target: Some Mayavi object on mode to apply the colormap</span>
<span class="sd">        cmap (sequence, None, False): name of a Matplotlib colormap, or</span>
<span class="sd">            a sequence of rgb(a) colors, or None to use the default,</span>
<span class="sd">            or False to leave the colormap alone.</span>
<span class="sd">        lut (int): number of entries desired in the lookup table</span>
<span class="sd">        alpha (number, sequence): scalar or array that sets the alpha</span>
<span class="sd">            (opacity) channel in the range [0..255]. This is expanded</span>
<span class="sd">            to both ends of the colormap using linear interpolation,</span>
<span class="sd">            i.e., [0, 255] will be a linear ramp from transparent to</span>
<span class="sd">            opaque over the whole colormap.</span>
<span class="sd">        mode (str): one of &#39;scalar&#39;, &#39;vector&#39;, or &#39;other&#39;</span>
<span class="sd">        clim (sequence): contains (vmin, vmax) for color scale</span>
<span class="sd">        symmetric (bool): force the limits on the colorbar to be</span>
<span class="sd">            symmetric around 0, and if no `cmap` is given, then also</span>
<span class="sd">            use the default symmetric colormap</span>
<span class="sd">        logscale (bool): Use a logarithmic color scale</span>

<span class="sd">    Raises:</span>
<span class="sd">        AttributeError: Description</span>
<span class="sd">        ValueError: Description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># get the mayavi lut object</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;scalar&quot;</span><span class="p">:</span>
            <span class="n">mvi_lut</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">module_manager</span><span class="o">.</span><span class="n">scalar_lut_manager</span><span class="o">.</span><span class="n">lut</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
            <span class="n">mvi_lut</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">module_manager</span><span class="o">.</span><span class="n">vector_lut_manager</span><span class="o">.</span><span class="n">lut</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="s2">&quot;other&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mode should be &#39;scalar&#39;, &#39;vector&#39;, or &quot;</span>
                                 <span class="s2">&quot;&#39;other&#39;; not &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">mvi_lut</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">lut</span>

    <span class="c1"># set the limits on the colorbar</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clim</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">mvi_lut</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="p">[</span><span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">clim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">symmetric</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">clim</span><span class="p">:</span>
        <span class="n">symmetric</span> <span class="o">=</span> <span class="n">clim</span>

    <span class="k">if</span> <span class="n">logscale</span> <span class="ow">and</span> <span class="n">symmetric</span><span class="p">:</span>
        <span class="n">viscid</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;logscale and symmetric are mutually exclusive;&quot;</span>
                              <span class="s2">&quot;ignoring symmetric.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">logscale</span><span class="p">:</span>
        <span class="n">mvi_lut</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;log10&#39;</span>
    <span class="k">elif</span> <span class="n">symmetric</span><span class="p">:</span>
        <span class="c1"># float(True) -&gt; 1</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">symmetric</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mvi_lut</span><span class="o">.</span><span class="n">range</span><span class="p">))</span>
        <span class="n">mvi_lut</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">]</span>

    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">mvi_lut</span><span class="o">.</span><span class="n">range</span>
    <span class="n">is_symmetric</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">vmax</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="c1"># now set the colormap</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mvi_lut</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="n">lut</span><span class="p">,</span> <span class="n">symmetric</span><span class="o">=</span><span class="n">is_symmetric</span><span class="p">)</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rgba</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgba</span><span class="p">)),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
        <span class="n">mvi_lut</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">rgba</span></div>

<div class="viewcode-block" id="insert_filter"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.insert_filter">[docs]</a><span class="k">def</span> <span class="nf">insert_filter</span><span class="p">(</span><span class="n">filtr</span><span class="p">,</span> <span class="n">module_manager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Insert a filter above an existing module_manager</span>

<span class="sd">    Args:</span>
<span class="sd">        filter (TYPE): Description</span>
<span class="sd">        module_manager (TYPE): Description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filtr</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">module_manager</span><span class="p">)</span>
    <span class="n">filtr</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module_manager</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_apply_rotation</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">from_system</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crd_system</span><span class="o">=</span><span class="s1">&#39;gse&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rotate</span><span class="p">,</span> <span class="s2">&quot;get_rotation_wxyz&quot;</span><span class="p">):</span>
        <span class="n">rotate</span> <span class="o">=</span> <span class="n">rotate</span><span class="o">.</span><span class="n">get_rotation_wxyz</span><span class="p">(</span><span class="n">from_system</span><span class="p">,</span> <span class="n">crd_system</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cotr</span> <span class="o">=</span> <span class="n">viscid</span><span class="o">.</span><span class="n">as_cotr</span><span class="p">(</span><span class="n">rotate</span><span class="p">)</span>
        <span class="n">rotate</span> <span class="o">=</span> <span class="n">cotr</span><span class="o">.</span><span class="n">get_rotation_wxyz</span><span class="p">(</span><span class="n">from_system</span><span class="p">,</span> <span class="n">crd_system</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rotate</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Rotate should be [angle, ux, uy, uz], got </span><span class="si">{0}</span><span class="s2">&quot;</span>
                         <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rotate</span><span class="p">))</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">rotate_wxyz</span><span class="p">(</span><span class="o">*</span><span class="n">rotate</span><span class="p">)</span>

<div class="viewcode-block" id="plot_blue_marble"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.plot_blue_marble">[docs]</a><span class="k">def</span> <span class="nf">plot_blue_marble</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nphi</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">ntheta</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">map_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crd_system</span><span class="o">=</span><span class="s1">&#39;gse&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot Earth using the Natural Earth dataset maps</span>

<span class="sd">    Args:</span>
<span class="sd">        r (float): radius of earth</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>
<span class="sd">        nphi (int): phi resolution of Earth&#39;s mesh</span>
<span class="sd">        ntheta (int): theta resolution of Earth&#39;s mesh</span>
<span class="sd">        map_style (str): Nothing for standard map, or &#39;faded&#39;</span>
<span class="sd">        lines (bool): Whether or not to show equator, tropics,</span>
<span class="sd">            arctic circles, and a couple meridians.</span>
<span class="sd">        res (int): Resolution in thousands of pixels longitude (must</span>
<span class="sd">            be one of 1, 2, 4, 8)</span>
<span class="sd">        rotate (None, sequence, str, datetime64): sequence of length 4</span>
<span class="sd">            that contains (angle, ux, uy, uz) for the angle and axis of</span>
<span class="sd">            a rotation, or a UT time as string or datetime64 to rotate</span>
<span class="sd">            earth to a specific date/time, or a cotr object in</span>
<span class="sd">            conjunction with crd_system</span>
<span class="sd">        crd_system (str, other): Used if rotate is datetime-like. Can</span>
<span class="sd">            be one of (&#39;gse&#39;, &#39;mhd&#39;), or anything that returns from</span>
<span class="sd">            :py:func:`viscid.as_crd_system`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (VTKDataSource, mayavi.modules.surface.Surface)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make a plane, then deform it into a sphere</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">PlaneSource</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="n">point1</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                          <span class="n">point2</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="n">x_resolution</span><span class="o">=</span><span class="n">nphi</span><span class="p">,</span>
                          <span class="n">y_resolution</span><span class="o">=</span><span class="n">ntheta</span><span class="p">)</span>

    <span class="n">ps</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">SphericalTransform</span><span class="p">()</span>
    <span class="n">tpoly</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">TransformPolyDataFilter</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                                         <span class="n">input_connection</span><span class="o">=</span><span class="n">ps</span><span class="o">.</span><span class="n">output_port</span><span class="p">)</span>
    <span class="n">tpoly</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">VTKDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tpoly</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;blue_marble&quot;</span><span class="p">)</span>
    <span class="n">surf</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

    <span class="c1"># now load a jpg, and use it to texture the sphere</span>

    <span class="n">linestr</span> <span class="o">=</span> <span class="s1">&#39;_lines&#39;</span> <span class="k">if</span> <span class="n">lines</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="k">assert</span> <span class="n">map_style</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;faded&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">map_style</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">map_style</span><span class="p">)</span> <span class="k">if</span> <span class="n">map_style</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="n">img_name</span> <span class="o">=</span> <span class="s2">&quot;images/earth</span><span class="si">{0}{1}</span><span class="s2">_</span><span class="si">{2}</span><span class="s2">k.jpg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">map_style</span><span class="p">,</span> <span class="n">linestr</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">img_name</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">JPEGReader</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">texture</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">input_connection</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">output_port</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">surf</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">enable_texture</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">surf</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="n">texture</span>
    <span class="n">surf</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># rotate 180deg b/c i can&#39;t rotate the texture to make the prime meridian</span>
    <span class="n">surf</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">_apply_rotation</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="s1">&#39;geo&#39;</span><span class="p">,</span> <span class="n">rotate</span><span class="p">,</span> <span class="n">crd_system</span><span class="o">=</span><span class="n">crd_system</span><span class="p">)</span>

    <span class="n">add_source</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">src</span><span class="p">,</span> <span class="n">surf</span></div>

<span class="n">plot_natural_earth</span> <span class="o">=</span> <span class="n">plot_blue_marble</span>

<div class="viewcode-block" id="plot_earth_3d"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.plot_earth_3d">[docs]</a><span class="k">def</span> <span class="nf">plot_earth_3d</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">daycol</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nightcol</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                  <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">crd_system</span><span class="o">=</span><span class="s2">&quot;gse&quot;</span><span class="p">,</span> <span class="n">night_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a black and white sphere (Earth) showing sunward direction</span>

<span class="sd">    Parameters:</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>
<span class="sd">        daycol (tuple, optional): color of dayside (RGB)</span>
<span class="sd">        nightcol (tuple, optional): color of nightside (RGB)</span>
<span class="sd">        res (optional): rosolution of teh sphere</span>
<span class="sd">        crd_system (str, other): One of (&#39;mhd&#39;, &#39;gse&#39;), or anything</span>
<span class="sd">            that returns from :py:func:`viscid.as_crd_system`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple (day, night) as vtk sources</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

    <span class="n">crd_system</span> <span class="o">=</span> <span class="n">viscid</span><span class="o">.</span><span class="n">as_crd_system</span><span class="p">(</span><span class="n">crd_system</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crd_system</span> <span class="o">==</span> <span class="s2">&quot;mhd&quot;</span><span class="p">:</span>
        <span class="n">theta_dusk</span><span class="p">,</span> <span class="n">theta_dawn</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">90</span>
    <span class="k">elif</span> <span class="n">crd_system</span> <span class="o">==</span> <span class="s2">&quot;gse&quot;</span><span class="p">:</span>
        <span class="n">theta_dusk</span><span class="p">,</span> <span class="n">theta_dawn</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">270</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use GSE convention?</span>
        <span class="n">theta_dusk</span><span class="p">,</span> <span class="n">theta_dawn</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">270</span>

    <span class="n">night</span> <span class="o">=</span> <span class="n">BuiltinSurface</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;night&#39;</span><span class="p">)</span>
    <span class="n">night</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                          <span class="n">start_theta</span><span class="o">=</span><span class="n">theta_dusk</span><span class="p">,</span> <span class="n">end_theta</span><span class="o">=</span><span class="n">theta_dawn</span><span class="p">,</span>
                          <span class="n">theta_resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">phi_resolution</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">night</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">nightcol</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mod</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">backface_culling</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">night_only</span><span class="p">:</span>
        <span class="n">day</span> <span class="o">=</span> <span class="n">BuiltinSurface</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
        <span class="n">day</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                            <span class="n">start_theta</span><span class="o">=</span><span class="n">theta_dawn</span><span class="p">,</span> <span class="n">end_theta</span><span class="o">=</span><span class="n">theta_dusk</span><span class="p">,</span>
                            <span class="n">theta_resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">phi_resolution</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">daycol</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">backface_culling</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">day</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">day</span><span class="p">,</span> <span class="n">night</span></div>

<div class="viewcode-block" id="to_mpl"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.to_mpl">[docs]</a><span class="k">def</span> <span class="nf">to_mpl</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hide</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">fit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display a mayavi figure inline in an Jupyter Notebook.</span>

<span class="sd">    This function takes a screenshot of a figure and blits it to a matplotlib</span>
<span class="sd">    figure using matplotlib.pyplot.imshow()</span>

<span class="sd">    Args:</span>
<span class="sd">        figure: A mayavi figure, if not specified, uses mlab.gcf()</span>
<span class="sd">        ax: Matplotlib axis of the destination (plt.gca() if None)</span>
<span class="sd">        size (None, tuple): if given, resize the scene in pixels (x, y)</span>
<span class="sd">        antialiased (bool): Antialias mayavi plot</span>
<span class="sd">        hide (bool): if True, try to hide the render window</span>
<span class="sd">        fit (None, bool): Resize mpl window to fit image exactly. If</span>
<span class="sd">            None, then fit if figure does not currently exist.</span>
<span class="sd">        **kwargs: passed to mayavi.mlab.screenshot()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">)</span>

    <span class="n">pixmap</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="n">antialiased</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># try to hide the window... Qt backend only</span>
    <span class="k">if</span> <span class="n">hide</span><span class="p">:</span>
        <span class="n">hide_window</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">viscid.plot</span> <span class="k">import</span> <span class="n">vpyplot</span> <span class="k">as</span> <span class="n">_</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
        <span class="c1"># if there are no figures, and fit is None, then fit</span>
        <span class="k">if</span> <span class="n">fit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fit</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">fit</span><span class="p">:</span>
        <span class="n">pltfig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">dpi</span> <span class="o">=</span> <span class="n">pltfig</span><span class="o">.</span><span class="n">get_dpi</span><span class="p">()</span>
        <span class="n">pltfig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="n">s</span> <span class="o">/</span> <span class="n">dpi</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">figure</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">get_size</span><span class="p">()],</span>
                               <span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">pltfig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                               <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="figure"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.figure">[docs]</a><span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">global_fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;global_fig&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">offscreen</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;offscreen&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">hide</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>

    <span class="k">if</span> <span class="n">offscreen</span><span class="p">:</span>
        <span class="n">viscid</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Since some backends are more picky than others,</span><span class="se">\n</span><span class="s2">&quot;</span>
                              <span class="s2">&quot;it is recomended that you rather use</span><span class="se">\n</span><span class="s2">&quot;</span>
                              <span class="s2">&quot;    vlab.mlab.options.offscreen = True</span><span class="se">\n</span><span class="s2">&quot;</span>
                              <span class="s2">&quot;near the top of __main__ to create an offscreen &quot;</span>
                              <span class="s2">&quot;figure.&quot;</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">global_fig</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_global_ns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;global_fig&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fig</span><span class="o">.</span><span class="n">scene</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">_global_ns</span><span class="p">[</span><span class="s1">&#39;global_fig&#39;</span><span class="p">]</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># make new figure</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># if size was set, run resize to account for the height of window</span>
        <span class="c1"># decorations</span>
        <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
        <span class="c1"># hide window by default?</span>
        <span class="k">if</span> <span class="n">hide</span> <span class="ow">or</span> <span class="p">(</span><span class="n">hide</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">offscreen</span><span class="p">):</span>
            <span class="n">hide_window</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="c1"># send it offscreen?</span>
        <span class="k">if</span> <span class="n">offscreen</span><span class="p">:</span>
            <span class="n">make_fig_offscreen</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">hide</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">global_fig</span><span class="p">:</span>
        <span class="n">_global_ns</span><span class="p">[</span><span class="s1">&#39;global_fig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>

    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="make_fig_offscreen"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.make_fig_offscreen">[docs]</a><span class="k">def</span> <span class="nf">make_fig_offscreen</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">hide</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">hide</span><span class="p">:</span>
        <span class="n">hide_window</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">off_screen_rendering</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">figure</span></div>

<div class="viewcode-block" id="show"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.show">[docs]</a><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calls :meth:`mayavi.mlab.show(stop=stop)`&quot;&quot;&quot;</span>
    <span class="n">mlab</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span></div>

<div class="viewcode-block" id="clf"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.clf">[docs]</a><span class="k">def</span> <span class="nf">clf</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clear source data, then clear figure</span>

<span class="sd">    Args:</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">figure</span><span class="p">:</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">clear_data</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
    <span class="n">mlab</span><span class="o">.</span><span class="n">clf</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span></div>

<div class="viewcode-block" id="remove_source"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.remove_source">[docs]</a><span class="k">def</span> <span class="nf">remove_source</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Safely remove a specific vtk source</span>

<span class="sd">    Args:</span>
<span class="sd">        src (vtk_data_source): vtk data source to remove</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">src</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">release_data</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
            <span class="n">src</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">release_data_flag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">src</span><span class="o">.</span><span class="n">cell_scalars_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">src</span><span class="o">.</span><span class="n">cell_tensors_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">src</span><span class="o">.</span><span class="n">cell_vectors_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">src</span><span class="o">.</span><span class="n">point_scalars_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">src</span><span class="o">.</span><span class="n">point_tensors_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">src</span><span class="o">.</span><span class="n">point_vectors_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">src</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">src</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="n">src</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></div>

<div class="viewcode-block" id="clear_data"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.clear_data">[docs]</a><span class="k">def</span> <span class="nf">clear_data</span><span class="p">(</span><span class="n">figures</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Workaround for Mayavi / VTK memory leak</span>

<span class="sd">    This is needed when Mayavi/VTK keeps a reference to source data</span>
<span class="sd">    when you would expect it to be freed like on a call to `mlab.clf()`</span>
<span class="sd">    or when removing sources from the pipeline.</span>

<span class="sd">    Note:</span>
<span class="sd">        This must be called when the pipeline still has the source, so</span>
<span class="sd">        before a call to `mlab.clf()`, etc.</span>

<span class="sd">    1. Set release_data_flag on all sources&#39; data</span>
<span class="sd">    2. Remove reference to the data</span>
<span class="sd">    3. Remove the data source</span>

<span class="sd">    Args:</span>
<span class="sd">        figures (None, mayavi.core.scene.Scene, or &#39;all&#39;): if None,</span>
<span class="sd">            gets current scene; if Scene object, just that one; if</span>
<span class="sd">            &#39;all&#39;, act on all scenes in the current engine. Can also be</span>
<span class="sd">            a list of Scene objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figures</span> <span class="o">=</span> <span class="p">[</span><span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()]</span>
    <span class="k">elif</span> <span class="n">figures</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="n">figures</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">get_engine</span><span class="p">()</span><span class="o">.</span><span class="n">scenes</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figures</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">figures</span> <span class="o">=</span> <span class="p">[</span><span class="n">figures</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
        <span class="c1"># # fig stop / start kills mayavi now, not sure why</span>
        <span class="c1"># fig.stop()</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
            <span class="n">remove_source</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="c1"># fig.start()</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="resize"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.resize">[docs]</a><span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>

<span class="sd">    Args:</span>
<span class="sd">        size (tuple): width, height in pixels</span>
<span class="sd">        figure (mayavi.core.scene.Scene): specific figure, or None for</span>
<span class="sd">            :py:func:`mayavi.mlab.gcf`</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># scene.set_size doesn&#39;t seem to work when rendering on screen, so</span>
        <span class="c1"># go into the backend and do it by hand</span>
        <span class="k">if</span> <span class="n">mlab</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">offscreen</span><span class="p">:</span>
            <span class="n">figure</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">figure</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">off_screen_rendering</span><span class="p">:</span>
            <span class="n">viscid</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;viscid.plot.vlab.resize doesn&#39;t work for</span><span class="se">\n</span><span class="s2">&quot;</span>
                                  <span class="s2">&quot;figures that are off-screened this way. I</span><span class="se">\n</span><span class="s2">&quot;</span>
                                  <span class="s2">&quot;suggest you use</span><span class="se">\n</span><span class="s2">&quot;</span>
                                  <span class="s2">&quot;    mayavi.mlab.options.offscreen = True</span><span class="se">\n</span><span class="s2">&quot;</span>
                                  <span class="s2">&quot;near the beginning of __main__&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_ets_config</span> <span class="o">=</span> <span class="n">mayavi</span><span class="o">.</span><span class="n">ETSConfig</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">traits.etsconfig.api</span> <span class="k">import</span> <span class="n">ETSConfig</span> <span class="k">as</span> <span class="n">_ets_config</span>
            <span class="n">toolkit</span> <span class="o">=</span> <span class="n">_ets_config</span><span class="o">.</span><span class="n">toolkit</span>

            <span class="k">if</span> <span class="n">toolkit</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;qt&#39;</span><span class="p">,</span> <span class="s1">&#39;qt4&#39;</span><span class="p">):</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">scene</span>
                <span class="n">widget11</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">childAt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;toolbar&#39;</span> <span class="ow">in</span> <span class="n">widget11</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">toolbar_height</span> <span class="o">=</span> <span class="n">widget11</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># window_size = sc.control.parent().size()</span>
                    <span class="c1"># render_size = sc.control.centralWidget().size()</span>
                    <span class="c1"># toolbar_height = window_size.height() - render_size.height()</span>
                    <span class="n">toolbar_height</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">toolbar_height</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">toolkit</span> <span class="o">==</span> <span class="s1">&#39;wx&#39;</span><span class="p">:</span>
                <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">figure</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Parent</span><span class="o">.</span><span class="n">Parent</span><span class="o">.</span><span class="n">SetClientSizeWH</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">viscid</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unknown mayavi backend </span><span class="si">{0}</span><span class="s2"> (not qt4 or &quot;</span>
                                      <span class="s2">&quot;wx); not resizing.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">toolkit</span><span class="p">))</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
        <span class="n">viscid</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Resize didn&#39;t work:: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>

<div class="viewcode-block" id="hide_window"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.hide_window">[docs]</a><span class="k">def</span> <span class="nf">hide_window</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Try to hide the window; only does something on Qt backend&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># fig.scene.control.parent().hide()</span>
        <span class="n">figure</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">showMinimized</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except,unused-variable</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Window hide didn&#39;t work::&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="savefig"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.savefig">[docs]</a><span class="k">def</span> <span class="nf">savefig</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrap mayavi.mlab.savefig with offscreen hack&quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">prev_offscreen_state</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">off_screen_rendering</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">off_screen_rendering</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">mlab</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fig</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">off_screen_rendering</span> <span class="o">!=</span> <span class="n">prev_offscreen_state</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">off_screen_rendering</span> <span class="o">=</span> <span class="n">prev_offscreen_state</span></div>

<div class="viewcode-block" id="interact"><a class="viewcode-back" href="../../../api/viscid.plot.vlab.html#viscid.plot.vlab.interact">[docs]</a><span class="k">def</span> <span class="nf">interact</span><span class="p">(</span><span class="n">stack_depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">viscid</span><span class="o">.</span><span class="n">vutil</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">stack_depth</span><span class="o">=</span><span class="n">stack_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mvi_ns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="n">plot3d_lines</span> <span class="o">=</span> <span class="n">plot_lines</span>
<span class="n">plot_lines3d</span> <span class="o">=</span> <span class="n">plot_lines</span>

<span class="c1">##</span>
<span class="c1">## EOF</span>
<span class="c1">##</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018, Kristofor Maynard.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>